# æ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunshansj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://gitee.com/qunmasj/projects)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€ä¿¡æ¯æŠ€æœ¯çš„è¿…çŒ›å‘å±•ï¼Œæ‰‹å†™æµç¨‹å›¾ä½œä¸ºä¸€ç§ç›´è§‚ä¸”é«˜æ•ˆçš„ä¿¡æ¯è¡¨è¾¾æ–¹å¼ï¼Œå¹¿æ³›åº”ç”¨äºæ•™è‚²ã€å·¥ç¨‹ã€ç®¡ç†ç­‰å¤šä¸ªé¢†åŸŸã€‚æ‰‹å†™æµç¨‹å›¾ä¸ä»…èƒ½å¤Ÿå¸®åŠ©äººä»¬ç†æ¸…æ€è·¯ã€æ¢³ç†é€»è¾‘å…³ç³»ï¼Œè¿˜èƒ½åœ¨å›¢é˜Ÿåä½œä¸­ä¿ƒè¿›ä¿¡æ¯çš„å…±äº«ä¸äº¤æµã€‚ç„¶è€Œï¼Œä¼ ç»Ÿçš„æ‰‹åŠ¨è¯†åˆ«å’Œå¤„ç†æ‰‹å†™æµç¨‹å›¾çš„æ–¹å¼å¾€å¾€æ•ˆç‡ä½ä¸‹ï¼Œä¸”å®¹æ˜“å—åˆ°äººä¸ºå› ç´ çš„å½±å“ï¼Œå¯¼è‡´è¯†åˆ«ç»“æœçš„ä¸å‡†ç¡®ã€‚å› æ­¤ï¼Œå¼€å‘ä¸€ç§é«˜æ•ˆã€å‡†ç¡®çš„æ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹ç³»ç»Ÿæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚

è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ä¸ºå›¾åƒè¯†åˆ«é¢†åŸŸå¸¦æ¥äº†é©å‘½æ€§çš„å˜åŒ–ã€‚å°¤å…¶æ˜¯ç›®æ ‡æ£€æµ‹ç®—æ³•çš„ä¸æ–­è¿›æ­¥ï¼Œä½¿å¾—å¯¹å¤æ‚åœºæ™¯ä¸­ç›®æ ‡çš„è¯†åˆ«å˜å¾—æ›´åŠ é«˜æ•ˆå’Œå‡†ç¡®ã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—ç®—æ³•ä½œä¸ºå½“å‰æœ€ä¸ºæµè¡Œçš„ç›®æ ‡æ£€æµ‹ç®—æ³•ä¹‹ä¸€ï¼Œå…¶å®æ—¶æ€§å’Œé«˜ç²¾åº¦çš„ç‰¹ç‚¹ä½¿å…¶åœ¨å„ç§åº”ç”¨åœºæ™¯ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„æ€§èƒ½å’Œé€‚åº”æ€§ï¼Œæˆä¸ºæ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹çš„ç†æƒ³é€‰æ‹©ã€‚

æœ¬ç ”ç©¶æ—¨åœ¨åŸºäºæ”¹è¿›çš„YOLOv8ç®—æ³•ï¼Œæ„å»ºä¸€ä¸ªä¸“é—¨é’ˆå¯¹æ‰‹å†™æµç¨‹å›¾å…ƒç´ çš„æ£€æµ‹ç³»ç»Ÿã€‚é€šè¿‡å¯¹æ•°æ®é›†â€œhandwritten flowchart part 3â€çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å‘ç°è¯¥æ•°æ®é›†åŒ…å«3300å¹…å›¾åƒï¼Œæ¶µç›–äº†å…­ç±»é‡è¦çš„æµç¨‹å›¾å…ƒç´ ï¼šç®­å¤´ã€ç®­å¤´å¤´ã€æ•°æ®ã€å†³ç­–ã€è¿‡ç¨‹å’Œç»ˆæ­¢ç¬¦ã€‚è¿™äº›å…ƒç´ åœ¨æµç¨‹å›¾ä¸­æ‰®æ¼”ç€å…³é”®è§’è‰²ï¼Œå…¶å‡†ç¡®è¯†åˆ«å¯¹äºæ•´ä¸ªæµç¨‹å›¾çš„ç†è§£å’Œè§£æè‡³å…³é‡è¦ã€‚å› æ­¤ï¼Œé’ˆå¯¹è¿™äº›å…ƒç´ çš„æ£€æµ‹ç³»ç»Ÿä¸ä»…å¯ä»¥æé«˜æ‰‹å†™æµç¨‹å›¾çš„è‡ªåŠ¨åŒ–å¤„ç†èƒ½åŠ›ï¼Œè¿˜èƒ½ä¸ºåç»­çš„å›¾åƒåˆ†æå’Œä¿¡æ¯æå–æä¾›åšå®çš„åŸºç¡€ã€‚

æœ¬ç ”ç©¶çš„æ„ä¹‰ä¸ä»…åœ¨äºæŠ€æœ¯å±‚é¢çš„åˆ›æ–°ï¼Œæ›´åœ¨äºå…¶å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚é€šè¿‡å®ç°é«˜æ•ˆçš„æ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨åŠ¨æ•™è‚²é¢†åŸŸçš„æ™ºèƒ½åŒ–å‘å±•ï¼Œå¸®åŠ©å­¦ç”Ÿå’Œæ•™å¸ˆæ›´å¥½åœ°è¿›è¡ŒçŸ¥è¯†çš„ä¼ é€’ä¸äº¤æµã€‚åŒæ—¶ï¼Œåœ¨å·¥ç¨‹å’Œç®¡ç†é¢†åŸŸï¼Œè¯¥ç³»ç»Ÿèƒ½å¤Ÿè¾…åŠ©å†³ç­–è€…å¿«é€Ÿç†è§£å¤æ‚çš„æµç¨‹ï¼Œæå‡å·¥ä½œæ•ˆç‡ã€‚æ­¤å¤–ï¼Œè¯¥ç ”ç©¶è¿˜å°†ä¸ºåç»­çš„å›¾åƒå¤„ç†å’Œäººå·¥æ™ºèƒ½æŠ€æœ¯çš„å‘å±•æä¾›æœ‰ç›Šçš„å€Ÿé‰´ï¼Œæ¨åŠ¨ç›¸å…³é¢†åŸŸçš„ç ”ç©¶è¿›å±•ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„æ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„å­¦æœ¯ä»·å€¼ï¼Œä¹Ÿå…·æœ‰å¹¿æ³›çš„å®é™…åº”ç”¨æ„ä¹‰ã€‚é€šè¿‡æœ¬ç ”ç©¶ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿä¸ºæ‰‹å†™æµç¨‹å›¾çš„è‡ªåŠ¨åŒ–å¤„ç†æä¾›æ–°çš„æ€è·¯å’Œæ–¹æ³•ï¼Œæ¨åŠ¨ç›¸å…³æŠ€æœ¯çš„è¿›æ­¥ä¸åº”ç”¨ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV16MtYe9EeL/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 6
names: ['arrow', 'arrowhead', 'data', 'decision', 'process', 'terminator']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†åä¸ºâ€œhandwritten flowchart part 3â€çš„æ•°æ®é›†ï¼Œä»¥è®­ç»ƒå’Œæ”¹è¿›YOLOv8æ¨¡å‹åœ¨æ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹ä¸­çš„è¡¨ç°ã€‚è¯¥æ•°æ®é›†ä¸“æ³¨äºæ‰‹å†™æµç¨‹å›¾çš„å„ç§å…ƒç´ ï¼Œå…·æœ‰ä¸°å¯Œçš„å¤šæ ·æ€§å’Œå¤æ‚æ€§ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ”¯æŒæ¨¡å‹çš„å­¦ä¹ å’Œæ³›åŒ–èƒ½åŠ›ã€‚æ•°æ®é›†åŒ…å«å…­ä¸ªä¸»è¦ç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯ç®­å¤´ï¼ˆarrowï¼‰ã€ç®­å¤´å¤´éƒ¨ï¼ˆarrowheadï¼‰ã€æ•°æ®ï¼ˆdataï¼‰ã€å†³ç­–ï¼ˆdecisionï¼‰ã€è¿‡ç¨‹ï¼ˆprocessï¼‰å’Œç»ˆæ­¢ç¬¦ï¼ˆterminatorï¼‰ã€‚è¿™äº›ç±»åˆ«çš„é€‰æ‹©åæ˜ äº†æµç¨‹å›¾ä¸­å¸¸è§çš„å…ƒç´ ï¼Œæ—¨åœ¨å¸®åŠ©æ¨¡å‹å‡†ç¡®è¯†åˆ«å’Œåˆ†ç±»æ‰‹å†™æµç¨‹å›¾ä¸­çš„ä¸åŒéƒ¨åˆ†ã€‚

åœ¨æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç ”ç©¶è€…ä»¬å¯¹æ‰‹å†™æµç¨‹å›¾è¿›è¡Œäº†ç²¾å¿ƒçš„æ”¶é›†å’Œæ ‡æ³¨ï¼Œç¡®ä¿æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬éƒ½å…·æœ‰ä»£è¡¨æ€§å’Œå¤šæ ·æ€§ã€‚ç®­å¤´å’Œç®­å¤´å¤´éƒ¨æ˜¯æµç¨‹å›¾ä¸­è¿æ¥ä¸åŒå…ƒç´ çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬çš„å½¢çŠ¶å’Œæ–¹å‘å¯¹æµç¨‹çš„ç†è§£è‡³å…³é‡è¦ã€‚æ•°æ®ç±»åˆ«ä¸­çš„â€œæ•°æ®â€å…ƒç´ åˆ™ä»£è¡¨äº†æµç¨‹å›¾ä¸­ä¿¡æ¯çš„ä¼ é€’ï¼Œé€šå¸¸ä»¥çŸ©å½¢æ¡†çš„å½¢å¼å‡ºç°ï¼Œæ‰¿è½½ç€å…·ä½“çš„å†…å®¹ã€‚å†³ç­–å…ƒç´ åˆ™ä»¥è±å½¢çš„å½¢å¼å‘ˆç°ï¼Œè¡¨ç¤ºæµç¨‹ä¸­çš„é€‰æ‹©ç‚¹ï¼Œæ¨¡å‹éœ€è¦èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å‡ºè¿™äº›å…³é”®çš„å†³ç­–èŠ‚ç‚¹ã€‚è¿‡ç¨‹å…ƒç´ é€šå¸¸æ˜¯æµç¨‹å›¾çš„æ ¸å¿ƒï¼Œæè¿°äº†å…·ä½“çš„æ“ä½œæˆ–æ­¥éª¤ï¼Œè€Œç»ˆæ­¢ç¬¦åˆ™æ ‡å¿—ç€æµç¨‹çš„ç»“æŸï¼Œé€šå¸¸ä»¥æ¤­åœ†å½¢æˆ–åœ†å½¢çš„å½¢å¼å‡ºç°ã€‚

ä¸ºäº†æé«˜æ¨¡å‹çš„æ£€æµ‹ç²¾åº¦å’Œé²æ£’æ€§ï¼Œæ•°æ®é›†ä¸­åŒ…å«äº†å¤§é‡çš„æ‰‹å†™æ ·æœ¬ï¼Œè¿™äº›æ ·æœ¬åœ¨é£æ ¼ã€ç¬”ç”»ç²—ç»†ã€å€¾æ–œè§’åº¦ç­‰æ–¹é¢å…·æœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚è¿™ç§å¤šæ ·æ€§ä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿå­¦ä¹ åˆ°ä¸åŒä¹¦å†™é£æ ¼çš„ç‰¹å¾ï¼Œä»è€Œåœ¨å®é™…åº”ç”¨ä¸­æ›´å¥½åœ°é€‚åº”å„ç§æ‰‹å†™æµç¨‹å›¾çš„è¯†åˆ«ä»»åŠ¡ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†è¿˜ç»è¿‡äº†ä¸¥æ ¼çš„é¢„å¤„ç†å’Œæ ‡æ³¨ï¼Œç¡®ä¿æ¯ä¸ªæ ·æœ¬çš„æ ‡æ³¨æ¡†ä¸å®é™…å…ƒç´ çš„è¾¹ç•Œç›¸ç¬¦ï¼Œä»è€Œä¸ºæ¨¡å‹æä¾›å‡†ç¡®çš„è®­ç»ƒæ•°æ®ã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ•°æ®å¢å¼ºæŠ€æœ¯ï¼Œä»¥è¿›ä¸€æ­¥ä¸°å¯Œæ•°æ®é›†çš„å¤šæ ·æ€§ã€‚è¿™äº›æŠ€æœ¯åŒ…æ‹¬éšæœºæ—‹è½¬ã€ç¼©æ”¾ã€å¹³ç§»ä»¥åŠé¢œè‰²å˜æ¢ç­‰ï¼Œæ—¨åœ¨æ¨¡æ‹Ÿä¸åŒçš„ä¹¦å†™ç¯å¢ƒå’Œæ¡ä»¶ï¼Œä»è€Œæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿæ„å»ºä¸€ä¸ªé«˜æ•ˆçš„æ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹ç³»ç»Ÿï¼Œèƒ½å¤Ÿåœ¨å®é™…åº”ç”¨ä¸­å¿«é€Ÿã€å‡†ç¡®åœ°è¯†åˆ«å’Œåˆ†ç±»å„ç§æ‰‹å†™æµç¨‹å›¾å…ƒç´ ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œâ€œhandwritten flowchart part 3â€æ•°æ®é›†ä¸ºæ”¹è¿›YOLOv8æ¨¡å‹æä¾›äº†åšå®çš„åŸºç¡€ï¼Œæ¶µç›–äº†æ‰‹å†™æµç¨‹å›¾ä¸­å¸¸è§çš„å…­ä¸ªç±»åˆ«ï¼Œå…·æœ‰ä¸°å¯Œçš„æ ·æœ¬å’Œå¤šæ ·çš„ç‰¹å¾ã€‚é€šè¿‡å¯¹è¯¥æ•°æ®é›†çš„æ·±å…¥åˆ†æå’Œåº”ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæ¨åŠ¨æ‰‹å†™æµç¨‹å›¾å…ƒç´ æ£€æµ‹æŠ€æœ¯çš„å‘å±•ï¼Œä¸ºç›¸å…³é¢†åŸŸçš„ç ”ç©¶å’Œåº”ç”¨æä¾›æœ‰åŠ›æ”¯æŒã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—ç›®æ ‡æ£€æµ‹ç®—æ³•è‡ª2015å¹´é¦–æ¬¡æå‡ºä»¥æ¥ï¼Œå·²ç»ç»å†äº†å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œé€æ­¥æ¼”åŒ–ä¸ºå¦‚ä»Šçš„YOLOv8ã€‚ä½œä¸ºå½“å‰ä¸šç•Œæœ€ä¸ºæµè¡Œå’ŒæˆåŠŸçš„ç›®æ ‡æ£€æµ‹ç®—æ³•ä¹‹ä¸€ï¼ŒYOLOv8åœ¨å¤šä¸ªæ–¹é¢å±•ç°å‡ºäº†æ˜¾è‘—çš„ä¼˜åŠ¿ï¼ŒåŒ…æ‹¬æ›´å¿«çš„æ¨ç†é€Ÿåº¦ã€æ›´é«˜çš„æ£€æµ‹ç²¾åº¦ã€æ›´åŠ å‹å¥½çš„è®­ç»ƒå’Œè°ƒæ•´è¿‡ç¨‹ï¼Œä»¥åŠå¹¿æ³›çš„ç¡¬ä»¶æ”¯æŒã€‚YOLOv8çš„æˆåŠŸä¸ä»…å¾—ç›Šäºå…¶åˆ›æ–°çš„ç½‘ç»œç»“æ„ï¼Œè¿˜æºäºå…¶å¯¹ç›®æ ‡æ£€æµ‹ä»»åŠ¡çš„æ·±åˆ»ç†è§£å’Œé«˜æ•ˆå®ç°ã€‚

YOLOv8çš„ç½‘ç»œç»“æ„å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šBackboneï¼ˆéª¨å¹²ç½‘ç»œï¼‰ã€Neckï¼ˆé¢ˆéƒ¨ç»“æ„ï¼‰å’ŒHeadï¼ˆå¤´éƒ¨ç»“æ„ï¼‰ã€‚å…¶ä¸­ï¼ŒBackboneè´Ÿè´£ç‰¹å¾æå–ï¼ŒNeckè´Ÿè´£ç‰¹å¾èåˆï¼Œè€ŒHeadåˆ™è´Ÿè´£æœ€ç»ˆçš„æ£€æµ‹ä¿¡æ¯è¾“å‡ºã€‚YOLOv8åœ¨Backboneä¸­ä¾ç„¶é‡‡ç”¨äº†è·¨çº§ç»“æ„ï¼ˆCross Stage Partial, CSPï¼‰çš„è®¾è®¡ç†å¿µï¼Œé€šè¿‡ä¼˜åŒ–YOLOv5ä¸­çš„C3æ¨¡å—ï¼Œä½¿ç”¨æ›´åŠ è½»é‡çš„ç»“æ„ï¼Œæå‡äº†ç‰¹å¾æå–çš„æ•ˆç‡ã€‚åŒæ—¶ï¼ŒYOLOv8ä¿ç•™äº†ç©ºé—´é‡‘å­—å¡”æ± åŒ–æ¨¡å—ï¼Œå¢å¼ºäº†å¯¹å¤šå°ºåº¦ç›®æ ‡çš„å¤„ç†èƒ½åŠ›ã€‚

åœ¨Neckéƒ¨åˆ†ï¼ŒYOLOv8é‡‡ç”¨äº†ç‰¹å¾å¢å¼ºç½‘ç»œï¼ˆPAN-FPNï¼‰çš„æ€æƒ³ï¼Œè¿™ç§ç»“æ„èƒ½å¤Ÿæœ‰æ•ˆåœ°èåˆæ¥è‡ªä¸åŒå±‚æ¬¡çš„ç‰¹å¾ï¼Œæå‡æ¨¡å‹å¯¹å¤æ‚åœºæ™¯çš„é€‚åº”èƒ½åŠ›ã€‚é€šè¿‡ç‰¹å¾èåˆï¼ŒYOLOv8èƒ½å¤Ÿåœ¨ä¸åŒå°ºåº¦ä¸Šæ›´å¥½åœ°æ•æ‰ç›®æ ‡ä¿¡æ¯ï¼Œç¡®ä¿åœ¨å¤šæ ·åŒ–çš„è¾“å…¥å›¾åƒä¸­ï¼Œæ¨¡å‹ä¾ç„¶èƒ½å¤Ÿä¿æŒé«˜æ•ˆçš„æ£€æµ‹æ€§èƒ½ã€‚

YOLOv8çš„Headéƒ¨åˆ†å¼•å…¥äº†è§£è€¦å¤´çš„è®¾è®¡ï¼Œå°†åˆ†ç±»å’Œå›å½’ä»»åŠ¡åˆ†å¼€å¤„ç†ã€‚ä¼ ç»Ÿçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹é€šå¸¸å°†è¿™ä¸¤ä¸ªä»»åŠ¡è€¦åˆåœ¨ä¸€èµ·ï¼Œå¯¼è‡´åœ¨å¤æ‚åœºæ™¯ä¸‹ï¼Œæ¨¡å‹å¯èƒ½ä¼šå‡ºç°å®šä½ä¸å‡†å’Œåˆ†ç±»é”™è¯¯çš„é—®é¢˜ã€‚è€ŒYOLOv8é€šè¿‡è§£è€¦ï¼Œä½¿å¾—æ¯ä¸ªä»»åŠ¡èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºè‡ªèº«çš„ç›®æ ‡ï¼Œä»è€Œæé«˜äº†æ•´ä½“çš„æ£€æµ‹ç²¾åº¦å’Œæ•ˆç‡ã€‚è¿™ç§è®¾è®¡ç†å¿µåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†ä¼ ç»Ÿæ–¹æ³•åœ¨å¤šç›®æ ‡æ£€æµ‹æ—¶çš„å±€é™æ€§ï¼Œä½¿å¾—YOLOv8åœ¨å¤„ç†å¤æ‚åœºæ™¯æ—¶è¡¨ç°å¾—æ›´åŠ å‡ºè‰²ã€‚

åœ¨æŸå¤±å‡½æ•°çš„è®¾è®¡ä¸Šï¼ŒYOLOv8ä¹Ÿè¿›è¡Œäº†åˆ›æ–°ã€‚è¯¥ç®—æ³•é‡‡ç”¨äº†æ–°çš„æŸå¤±ç­–ç•¥ï¼Œé€šè¿‡å˜ç„¦æŸå¤±è®¡ç®—åˆ†ç±»æŸå¤±ï¼Œå¹¶ä½¿ç”¨æ•°æ®å¹³å‡ä¿çœŸåº¦æŸå¤±å’Œå®Œç¾äº¤å¹¶æ¯”æŸå¤±æ¥è®¡ç®—è¾¹ç•Œæ¡†æŸå¤±ã€‚è¿™ç§æ–°é¢–çš„æŸå¤±è®¡ç®—æ–¹å¼ä½¿å¾—YOLOv8åœ¨ç›®æ ‡æ£€æµ‹çš„å‡†ç¡®æ€§ä¸Šæœ‰äº†æ˜¾è‘—æå‡ï¼Œå°¤å…¶æ˜¯åœ¨é¢å¯¹å°ç›®æ ‡å’Œé‡å ç›®æ ‡æ—¶ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°è¿›è¡ŒåŒºåˆ†å’Œå®šä½ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒYOLOv8é‡‡ç”¨äº†Anchor-freeç›®æ ‡æ£€æµ‹æ–¹æ³•ï¼Œè¿™ä¸€åˆ›æ–°ä½¿å¾—æ¨¡å‹ä¸å†ä¾èµ–äºé¢„å…ˆå®šä¹‰çš„é”šç‚¹æ¡†ã€‚ä¼ ç»Ÿçš„ç›®æ ‡æ£€æµ‹æ–¹æ³•é€šå¸¸éœ€è¦æ ¹æ®æ•°æ®é›†çš„ç‰¹ç‚¹æ‰‹åŠ¨é€‰æ‹©å’Œè°ƒæ•´é”šç‚¹æ¡†ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸ä»…ç¹çï¼Œè€Œä¸”å¯¹äºä¸åŒå°ºåº¦å’Œå½¢çŠ¶çš„ç›®æ ‡ï¼Œå¯èƒ½éœ€è¦è®¾è®¡ä¸åŒçš„é”šç‚¹æ¡†ã€‚YOLOv8é€šè¿‡ç›´æ¥é¢„æµ‹ç›®æ ‡çš„ä½ç½®å’Œå¤§å°ï¼Œç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼Œè®©ç½‘ç»œèƒ½å¤Ÿæ›´å¿«åœ°èšç„¦äºç›®æ ‡ä½ç½®çš„é‚»è¿‘ç‚¹ï¼Œä»è€Œä½¿å¾—é¢„æµ‹æ¡†æ›´æ¥è¿‘äºå®é™…çš„è¾¹ç•Œæ¡†åŒºåŸŸã€‚

YOLOv8çš„æ·±åº¦å’Œå®½åº¦è®¾ç½®ä¹Ÿä¸ºå…¶æ€§èƒ½çš„æå‡æä¾›äº†æ”¯æŒã€‚é€šè¿‡depth_factorå’Œwidth_factorå‚æ•°çš„çµæ´»è®¾ç½®ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ¨¡å‹çš„æ·±åº¦å’Œå®½åº¦ï¼Œä»è€Œåœ¨ä¿è¯æ£€æµ‹ç²¾åº¦çš„å‰æä¸‹ï¼Œä¼˜åŒ–æ¨¡å‹çš„è®¡ç®—æ•ˆç‡ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—YOLOv8èƒ½å¤Ÿé€‚åº”å¤šç§åº”ç”¨åœºæ™¯ï¼Œä»åµŒå…¥å¼è®¾å¤‡åˆ°é«˜æ€§èƒ½è®¡ç®—å¹³å°ï¼Œéƒ½èƒ½å‘æŒ¥å‡ºè‰²çš„æ€§èƒ½ã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8çš„åŸå§‹ç®—æ³•åŸç†æ˜¯é€šè¿‡ä¸€ç³»åˆ—åˆ›æ–°å’Œä¼˜åŒ–ï¼Œæå‡äº†ç›®æ ‡æ£€æµ‹çš„æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚å…¶ç‹¬ç‰¹çš„ç½‘ç»œç»“æ„è®¾è®¡ã€è§£è€¦çš„ä»»åŠ¡å¤„ç†æ–¹å¼ã€åˆ›æ–°çš„æŸå¤±è®¡ç®—ç­–ç•¥ä»¥åŠAnchor-freeçš„æ£€æµ‹æ–¹æ³•ï¼Œä½¿å¾—YOLOv8åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸæ ‘ç«‹äº†æ–°çš„æ ‡æ†ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ï¼ŒYOLOv8ä¸ä»…åœ¨å­¦æœ¯ç ”ç©¶ä¸­å±•ç°å‡ºå·¨å¤§çš„æ½œåŠ›ï¼Œä¹Ÿåœ¨å®é™…åº”ç”¨ä¸­ä¸ºå„ç±»æ™ºèƒ½è§†è§‰ç³»ç»Ÿæä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚æ— è®ºæ˜¯åœ¨å®‰é˜²ç›‘æ§ã€è‡ªåŠ¨é©¾é©¶ï¼Œè¿˜æ˜¯åœ¨å·¥ä¸šæ£€æµ‹ã€åŒ»ç–—å½±åƒç­‰é¢†åŸŸï¼ŒYOLOv8éƒ½å±•ç°å‡ºäº†å¹¿æ³›çš„åº”ç”¨å‰æ™¯å’Œå¼ºå¤§çš„å¸‚åœºç«äº‰åŠ›ã€‚é€šè¿‡å¯¹YOLOv8çš„æ·±å…¥ç ”ç©¶å’Œåº”ç”¨å¼€å‘ï¼Œæœªæ¥çš„ç›®æ ‡æ£€æµ‹æŠ€æœ¯å°†æ›´åŠ æ™ºèƒ½ã€é«˜æ•ˆï¼Œä¸ºå„è¡Œå„ä¸šçš„æ•°å­—åŒ–è½¬å‹æä¾›åšå®çš„åŸºç¡€ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 code\ultralytics\hub\session.py

ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æå’Œè¯¦ç»†æ³¨é‡Šçš„ç»“æœï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license

import threading
import time
from http import HTTPStatus
from pathlib import Path
import requests
from ultralytics.hub.utils import HUB_WEB_ROOT, HELP_MSG, PREFIX, TQDM
from ultralytics.utils import LOGGER, SETTINGS, __version__, checks, emojis, is_colab
from ultralytics.utils.errors import HUBModelError

# æ ¹æ®è¿è¡Œç¯å¢ƒè®¾ç½®ä»£ç†åç§°
AGENT_NAME = f"python-{__version__}-colab" if is_colab() else f"python-{__version__}-local"

class HUBTrainingSession:
    """
    HUBTrainingSessionç±»ç”¨äºç®¡ç†Ultralytics HUB YOLOæ¨¡å‹çš„è®­ç»ƒä¼šè¯ã€‚
    å¤„ç†æ¨¡å‹åˆå§‹åŒ–ã€å¿ƒè·³ç›‘æµ‹å’Œæ£€æŸ¥ç‚¹ä¸Šä¼ ç­‰åŠŸèƒ½ã€‚
    """

    def __init__(self, identifier):
        """
        åˆå§‹åŒ–HUBTrainingSessionï¼Œè®¾ç½®æ¨¡å‹æ ‡è¯†ç¬¦ã€‚

        Args:
            identifier (str): æ¨¡å‹æ ‡è¯†ç¬¦ï¼Œå¯ä»¥æ˜¯URLå­—ç¬¦ä¸²æˆ–ç‰¹å®šæ ¼å¼çš„æ¨¡å‹é”®ã€‚
        """
        from hub_sdk import HUBClient

        # è®¾ç½®APIè°ƒç”¨çš„é€Ÿç‡é™åˆ¶
        self.rate_limits = {
            "metrics": 3.0,
            "ckpt": 900.0,
            "heartbeat": 300.0,
        }
        self.metrics_queue = {}  # å­˜å‚¨æ¯ä¸ªepochçš„æŒ‡æ ‡
        self.timers = {}  # å­˜å‚¨å®šæ—¶å™¨

        # è§£æè¾“å…¥çš„æ ‡è¯†ç¬¦
        api_key, model_id, self.filename = self._parse_identifier(identifier)

        # è·å–å‡­è¯
        active_key = api_key or SETTINGS.get("api_key")
        credentials = {"api_key": active_key} if active_key else None  # è®¾ç½®å‡­è¯

        # åˆå§‹åŒ–HUBå®¢æˆ·ç«¯
        self.client = HUBClient(credentials)

        # åŠ è½½æ¨¡å‹
        if model_id:
            self.load_model(model_id)  # åŠ è½½å·²æœ‰æ¨¡å‹
        else:
            self.model = self.client.model()  # åŠ è½½ç©ºæ¨¡å‹

    def load_model(self, model_id):
        """ä»Ultralytics HUBåŠ è½½ç°æœ‰æ¨¡å‹ã€‚"""
        self.model = self.client.model(model_id)
        if not self.model.data:  # å¦‚æœæ¨¡å‹ä¸å­˜åœ¨
            raise ValueError(emojis("âŒ æŒ‡å®šçš„HUBæ¨¡å‹ä¸å­˜åœ¨"))

        # è®¾ç½®æ¨¡å‹çš„URL
        self.model_url = f"{HUB_WEB_ROOT}/models/{self.model.id}"

        # è®¾ç½®è®­ç»ƒå‚æ•°
        self._set_train_args()

        # å¯åŠ¨å¿ƒè·³ç›‘æµ‹
        self.model.start_heartbeat(self.rate_limits["heartbeat"])
        LOGGER.info(f"{PREFIX}æŸ¥çœ‹æ¨¡å‹: {self.model_url} ğŸš€")

    def _parse_identifier(self, identifier):
        """
        è§£æç»™å®šçš„æ ‡è¯†ç¬¦ï¼Œæå–ç›¸å…³ç»„ä»¶ã€‚

        Args:
            identifier (str): è¦è§£æçš„æ ‡è¯†ç¬¦å­—ç¬¦ä¸²ã€‚

        Returns:
            (tuple): åŒ…å«APIå¯†é’¥ã€æ¨¡å‹IDå’Œæ–‡ä»¶åçš„å…ƒç»„ã€‚
        """
        api_key, model_id, filename = None, None, None

        # æ£€æŸ¥æ ‡è¯†ç¬¦æ˜¯å¦ä¸ºHUB URL
        if identifier.startswith(f"{HUB_WEB_ROOT}/models/"):
            model_id = identifier.split(f"{HUB_WEB_ROOT}/models/")[-1]
        else:
            parts = identifier.split("_")
            if len(parts) == 2 and len(parts[0]) == 42 and len(parts[1]) == 20:
                api_key, model_id = parts
            elif len(parts) == 1 and len(parts[0]) == 20:
                model_id = parts[0]
            elif identifier.endswith(".pt") or identifier.endswith(".yaml"):
                filename = identifier
            else:
                raise HUBModelError(
                    f"æ¨¡å‹='{identifier}'æ— æ³•è§£æã€‚è¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚"
                )

        return api_key, model_id, filename

    def request_queue(self, request_func, retry=3, timeout=30, thread=True, verbose=True, progress_total=None, *args, **kwargs):
        """
        å°è£…è¯·æ±‚åŠŸèƒ½ï¼Œæ”¯æŒé‡è¯•å’Œè¶…æ—¶è®¾ç½®ã€‚

        Args:
            request_func: è¦è°ƒç”¨çš„è¯·æ±‚å‡½æ•°ã€‚
            retry (int): é‡è¯•æ¬¡æ•°ã€‚
            timeout (int): è¶…æ—¶æ—¶é—´ã€‚
            thread (bool): æ˜¯å¦åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œã€‚
            verbose (bool): æ˜¯å¦æ‰“å°è¯¦ç»†ä¿¡æ¯ã€‚
            progress_total (int): ä¸Šä¼ è¿›åº¦çš„æ€»é‡ã€‚
        """
        def retry_request():
            """å°è¯•è°ƒç”¨è¯·æ±‚å‡½æ•°ï¼Œæ”¯æŒé‡è¯•å’Œè¶…æ—¶ã€‚"""
            t0 = time.time()  # è®°å½•å¼€å§‹æ—¶é—´
            for i in range(retry + 1):
                if (time.time() - t0) > timeout:
                    LOGGER.warning(f"{PREFIX}è¯·æ±‚è¶…æ—¶ã€‚{HELP_MSG}")
                    break  # è¶…æ—¶ï¼Œé€€å‡ºå¾ªç¯

                response = request_func(*args, **kwargs)
                if progress_total:
                    self._show_upload_progress(progress_total, response)

                if response is None:
                    LOGGER.warning(f"{PREFIX}è¯·æ±‚æœªè¿”å›å“åº”ã€‚{HELP_MSG}")
                    time.sleep(2**i)  # æŒ‡æ•°é€€é¿
                    continue  # ç»§ç»­é‡è¯•

                if HTTPStatus.OK <= response.status_code < HTTPStatus.MULTIPLE_CHOICES:
                    return response  # æˆåŠŸï¼Œæ— éœ€é‡è¯•

                if i == 0:
                    message = self._get_failure_message(response, retry, timeout)
                    if verbose:
                        LOGGER.warning(f"{PREFIX}{message} {HELP_MSG} ({response.status_code})")

                if not self._should_retry(response.status_code):
                    LOGGER.warning(f"{PREFIX}è¯·æ±‚å¤±è´¥ã€‚{HELP_MSG} ({response.status_code})")
                    break  # ä¸éœ€è¦é‡è¯•ï¼Œé€€å‡ºå¾ªç¯

                time.sleep(2**i)  # æŒ‡æ•°é€€é¿

            return response

        if thread:
            threading.Thread(target=retry_request, daemon=True).start()  # åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œ
        else:
            return retry_request()  # åœ¨ä¸»çº¿ç¨‹ä¸­ç›´æ¥è°ƒç”¨

    def upload_metrics(self):
        """ä¸Šä¼ æ¨¡å‹æŒ‡æ ‡åˆ°Ultralytics HUBã€‚"""
        return self.request_queue(self.model.upload_metrics, metrics=self.metrics_queue.copy(), thread=True)

    def upload_model(self, epoch: int, weights: str, is_best: bool = False, map: float = 0.0, final: bool = False) -> None:
        """
        ä¸Šä¼ æ¨¡å‹æ£€æŸ¥ç‚¹åˆ°Ultralytics HUBã€‚

        Args:
            epoch (int): å½“å‰è®­ç»ƒçš„epochã€‚
            weights (str): æ¨¡å‹æƒé‡æ–‡ä»¶çš„è·¯å¾„ã€‚
            is_best (bool): å½“å‰æ¨¡å‹æ˜¯å¦ä¸ºæœ€ä½³æ¨¡å‹ã€‚
            map (float): æ¨¡å‹çš„å¹³å‡ç²¾åº¦ã€‚
            final (bool): å½“å‰æ¨¡å‹æ˜¯å¦ä¸ºæœ€ç»ˆæ¨¡å‹ã€‚
        """
        if Path(weights).is_file():
            progress_total = Path(weights).stat().st_size if final else None  # ä»…åœ¨æœ€ç»ˆæ¨¡å‹æ—¶æ˜¾ç¤ºè¿›åº¦
            self.request_queue(
                self.model.upload_model,
                epoch=epoch,
                weights=weights,
                is_best=is_best,
                map=map,
                final=final,
                retry=10,
                timeout=3600,
                thread=not final,
                progress_total=progress_total,
            )
        else:
            LOGGER.warning(f"{PREFIX}è­¦å‘Š âš ï¸ æ¨¡å‹ä¸Šä¼ é—®é¢˜ã€‚ç¼ºå°‘æ¨¡å‹ {weights}ã€‚")

    def _show_upload_progress(self, content_length: int, response: requests.Response) -> None:
        """
        æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ è¿›åº¦æ¡ã€‚

        Args:
            content_length (int): è¦ä¸Šä¼ å†…å®¹çš„æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚
            response (requests.Response): æ–‡ä»¶ä¸Šä¼ è¯·æ±‚çš„å“åº”å¯¹è±¡ã€‚
        """
        with TQDM(total=content_length, unit="B", unit_scale=True, unit_divisor=1024) as pbar:
            for data in response.iter_content(chunk_size=1024):
                pbar.update(len(data))  # æ›´æ–°è¿›åº¦æ¡
```

### ä»£ç åˆ†ææ€»ç»“ï¼š
1. **HUBTrainingSessionç±»**ï¼šè¯¥ç±»è´Ÿè´£ç®¡ç†ä¸Ultralytics HUBçš„äº¤äº’ï¼ŒåŒ…æ‹¬æ¨¡å‹çš„åŠ è½½ã€å¿ƒè·³ç›‘æµ‹ã€æŒ‡æ ‡ä¸Šä¼ å’Œæ¨¡å‹æ£€æŸ¥ç‚¹ä¸Šä¼ ç­‰åŠŸèƒ½ã€‚
2. **åˆå§‹åŒ–å’ŒåŠ è½½æ¨¡å‹**ï¼šåœ¨åˆå§‹åŒ–æ—¶è§£ææ¨¡å‹æ ‡è¯†ç¬¦ï¼Œå¹¶æ ¹æ®æ ‡è¯†ç¬¦åŠ è½½ç›¸åº”çš„æ¨¡å‹ã€‚
3. **è¯·æ±‚é˜Ÿåˆ—**ï¼šå°è£…äº†è¯·æ±‚çš„é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿åœ¨è¯·æ±‚å¤±è´¥æ—¶èƒ½å¤Ÿè‡ªåŠ¨é‡è¯•ï¼Œå¹¶æ”¯æŒè¶…æ—¶è®¾ç½®ã€‚
4. **ä¸Šä¼ åŠŸèƒ½**ï¼šæä¾›äº†ä¸Šä¼ æ¨¡å‹æŒ‡æ ‡å’Œæ¨¡å‹æƒé‡çš„åŠŸèƒ½ï¼Œç¡®ä¿è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ•°æ®èƒ½å¤ŸåŠæ—¶ä¸Šä¼ åˆ°HUBè¿›è¡Œç›‘æ§å’Œå­˜å‚¨ã€‚

é€šè¿‡è¿™äº›æ ¸å¿ƒåŠŸèƒ½ï¼ŒHUBTrainingSessionç±»èƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†YOLOæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶ä¸Ultralytics HUBè¿›è¡Œå®æ—¶äº¤äº’ã€‚

è¿™ä¸ªæ–‡ä»¶æ˜¯Ultralytics YOLOé¡¹ç›®ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸»è¦ç”¨äºç®¡ç†ä¸Ultralytics HUBçš„è®­ç»ƒä¼šè¯ã€‚å®ƒåŒ…å«äº†æ¨¡å‹çš„åˆå§‹åŒ–ã€å¿ƒè·³ç›‘æµ‹å’Œæ£€æŸ¥ç‚¹ä¸Šä¼ ç­‰åŠŸèƒ½ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º`HUBTrainingSession`çš„ç±»ï¼Œè¯¥ç±»çš„ä¸»è¦èŒè´£æ˜¯å¤„ç†ä¸Ultralytics HUBçš„äº¤äº’ï¼ŒåŒ…æ‹¬æ¨¡å‹çš„åŠ è½½ã€åˆ›å»ºå’Œä¸Šä¼ è®­ç»ƒæŒ‡æ ‡ç­‰ã€‚

åœ¨ç±»çš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€äº›é€Ÿç‡é™åˆ¶ï¼Œä»¥æ§åˆ¶ä¸åŒAPIè°ƒç”¨çš„é¢‘ç‡ã€‚æ¥ç€ï¼Œè§£æè¾“å…¥çš„æ¨¡å‹æ ‡è¯†ç¬¦ï¼Œæå–å‡ºAPIå¯†é’¥ã€æ¨¡å‹IDå’Œæ–‡ä»¶åã€‚æ ¹æ®è§£æçš„ç»“æœï¼Œä½¿ç”¨`HUBClient`åˆå§‹åŒ–ä¸Ultralytics HUBçš„è¿æ¥ã€‚å¦‚æœæä¾›äº†æ¨¡å‹IDï¼Œåˆ™åŠ è½½ç°æœ‰æ¨¡å‹ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç©ºæ¨¡å‹ã€‚

`load_model`æ–¹æ³•ç”¨äºä»Ultralytics HUBåŠ è½½ç°æœ‰æ¨¡å‹ï¼Œå¹¶å¯åŠ¨å¿ƒè·³ç›‘æµ‹ä»¥ä¾¿äºæœåŠ¡å™¨ç›‘æ§ä»£ç†çš„çŠ¶æ€ã€‚å¦‚æœæ¨¡å‹ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚`create_model`æ–¹æ³•åˆ™ç”¨äºæ ¹æ®ç»™å®šçš„æ¨¡å‹å‚æ•°åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„è®­ç»ƒä¼šè¯ï¼Œå¹¶åŒæ ·å¯åŠ¨å¿ƒè·³ç›‘æµ‹ã€‚

`_parse_identifier`æ–¹æ³•è´Ÿè´£è§£æè¾“å…¥çš„æ ‡è¯†ç¬¦ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬HUB URLã€APIå¯†é’¥å’Œæ¨¡å‹IDçš„ç»„åˆã€å•ä¸€æ¨¡å‹IDæˆ–æœ¬åœ°æ–‡ä»¶åã€‚è§£æåè¿”å›APIå¯†é’¥ã€æ¨¡å‹IDå’Œæ–‡ä»¶åã€‚

`_set_train_args`æ–¹æ³•ç”¨äºåˆå§‹åŒ–è®­ç»ƒå‚æ•°ï¼Œå¹¶åœ¨Ultralytics HUBä¸Šåˆ›å»ºæ¨¡å‹æ¡ç›®ã€‚å®ƒä¼šæ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²ç»è®­ç»ƒè¿‡ï¼Œæ˜¯å¦å¯ä»¥æ¢å¤è®­ç»ƒï¼Œå¹¶æ ¹æ®æ¨¡å‹çš„çŠ¶æ€è®¾ç½®ç›¸åº”çš„è®­ç»ƒå‚æ•°ã€‚

`request_queue`æ–¹æ³•æ˜¯ä¸€ä¸ªé€šç”¨çš„è¯·æ±‚å¤„ç†å‡½æ•°ï¼Œæ”¯æŒé‡è¯•æœºåˆ¶ã€è¶…æ—¶è®¾ç½®å’Œå¯é€‰çš„çº¿ç¨‹å¤„ç†ã€‚å®ƒä¼šæ ¹æ®HTTPå“åº”çŠ¶æ€ç å†³å®šæ˜¯å¦é‡è¯•è¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚å¤±è´¥æ—¶æä¾›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚

`upload_metrics`å’Œ`upload_model`æ–¹æ³•åˆ†åˆ«ç”¨äºä¸Šä¼ æ¨¡å‹çš„è®­ç»ƒæŒ‡æ ‡å’Œæ¨¡å‹æ£€æŸ¥ç‚¹åˆ°Ultralytics HUBã€‚`_show_upload_progress`æ–¹æ³•åˆ™ç”¨äºæ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ çš„è¿›åº¦æ¡ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£ä¸Šä¼ çŠ¶æ€ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ¨¡å—çš„è®¾è®¡ä½¿å¾—ä¸Ultralytics HUBçš„äº¤äº’å˜å¾—æ›´åŠ é«˜æ•ˆå’Œç”¨æˆ·å‹å¥½ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½æ¥æ”¯æŒYOLOæ¨¡å‹çš„è®­ç»ƒå’Œç®¡ç†ã€‚

#### 11.2 code\ultralytics\models\sam\modules\encoders.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬ `ImageEncoderViT` ç±»åŠå…¶ç›¸å…³çš„åŠŸèƒ½ã€‚ä»£ç ä¸­åŒ…å«äº†å¯¹ä¸»è¦åŠŸèƒ½çš„è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼Œä»¥å¸®åŠ©ç†è§£å…¶å·¥ä½œåŸç†ã€‚

```python
import torch
import torch.nn as nn
from typing import Optional, Tuple, Type

class ImageEncoderViT(nn.Module):
    """
    ä½¿ç”¨è§†è§‰å˜æ¢å™¨ï¼ˆViTï¼‰æ¶æ„çš„å›¾åƒç¼–ç å™¨ï¼Œå°†å›¾åƒç¼–ç ä¸ºç´§å‡‘çš„æ½œåœ¨ç©ºé—´ã€‚
    ç¼–ç å™¨å°†å›¾åƒåˆ†å‰²ä¸ºè¡¥ä¸ï¼Œå¹¶é€šè¿‡ä¸€ç³»åˆ—å˜æ¢å—å¤„ç†è¿™äº›è¡¥ä¸ã€‚
    æœ€ç»ˆçš„ç¼–ç è¡¨ç¤ºé€šè¿‡ä¸€ä¸ªâ€œneckâ€æ¨¡å—ç”Ÿæˆã€‚
    """

    def __init__(
        self,
        img_size: int = 1024,  # è¾“å…¥å›¾åƒçš„å°ºå¯¸ï¼Œå‡è®¾ä¸ºæ­£æ–¹å½¢
        patch_size: int = 16,   # æ¯ä¸ªè¡¥ä¸çš„å°ºå¯¸
        in_chans: int = 3,      # è¾“å…¥å›¾åƒçš„é€šé“æ•°ï¼ˆRGBå›¾åƒä¸º3ï¼‰
        embed_dim: int = 768,   # è¡¥ä¸åµŒå…¥çš„ç»´åº¦
        depth: int = 12,        # ViTçš„æ·±åº¦ï¼ˆå˜æ¢å—çš„æ•°é‡ï¼‰
        num_heads: int = 12,    # æ¯ä¸ªå˜æ¢å—ä¸­çš„æ³¨æ„åŠ›å¤´æ•°é‡
        mlp_ratio: float = 4.0, # MLPéšè—å±‚ç»´åº¦ä¸åµŒå…¥ç»´åº¦çš„æ¯”ç‡
        out_chans: int = 256,   # è¾“å‡ºé€šé“æ•°
        norm_layer: Type[nn.Module] = nn.LayerNorm,  # å½’ä¸€åŒ–å±‚
        act_layer: Type[nn.Module] = nn.GELU,         # æ¿€æ´»å±‚
    ) -> None:
        """
        åˆå§‹åŒ–å›¾åƒç¼–ç å™¨çš„å‚æ•°ã€‚
        """
        super().__init__()
        self.img_size = img_size

        # è¡¥ä¸åµŒå…¥æ¨¡å—ï¼Œå°†å›¾åƒåˆ†å‰²ä¸ºè¡¥ä¸å¹¶è¿›è¡ŒåµŒå…¥
        self.patch_embed = PatchEmbed(
            kernel_size=(patch_size, patch_size),
            stride=(patch_size, patch_size),
            in_chans=in_chans,
            embed_dim=embed_dim,
        )

        # ç»å¯¹ä½ç½®åµŒå…¥å‚æ•°
        self.pos_embed: Optional[nn.Parameter] = nn.Parameter(torch.zeros(1, img_size // patch_size, img_size // patch_size, embed_dim))

        # åˆ›å»ºå˜æ¢å—
        self.blocks = nn.ModuleList()
        for _ in range(depth):
            block = Block(
                dim=embed_dim,
                num_heads=num_heads,
                mlp_ratio=mlp_ratio,
                norm_layer=norm_layer,
                act_layer=act_layer,
            )
            self.blocks.append(block)

        # â€œneckâ€æ¨¡å—ï¼Œè¿›ä¸€æ­¥å¤„ç†è¾“å‡º
        self.neck = nn.Sequential(
            nn.Conv2d(embed_dim, out_chans, kernel_size=1, bias=False),
            norm_layer(out_chans),
            nn.Conv2d(out_chans, out_chans, kernel_size=3, padding=1, bias=False),
            norm_layer(out_chans),
        )

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """
        å¤„ç†è¾“å…¥å›¾åƒï¼Œé€šè¿‡è¡¥ä¸åµŒå…¥ã€ä½ç½®åµŒå…¥ã€å˜æ¢å—å’Œâ€œneckâ€æ¨¡å—ã€‚
        """
        x = self.patch_embed(x)  # å°†å›¾åƒè½¬æ¢ä¸ºè¡¥ä¸åµŒå…¥
        x = x + self.pos_embed   # æ·»åŠ ä½ç½®åµŒå…¥
        for blk in self.blocks:   # é€šè¿‡æ¯ä¸ªå˜æ¢å—
            x = blk(x)
        return self.neck(x.permute(0, 3, 1, 2))  # é€šè¿‡â€œneckâ€æ¨¡å—å¹¶è°ƒæ•´ç»´åº¦

class PatchEmbed(nn.Module):
    """å›¾åƒåˆ°è¡¥ä¸åµŒå…¥çš„è½¬æ¢æ¨¡å—ã€‚"""

    def __init__(
        self,
        kernel_size: Tuple[int, int] = (16, 16),  # å·ç§¯æ ¸å¤§å°
        stride: Tuple[int, int] = (16, 16),       # æ­¥å¹…
        in_chans: int = 3,                        # è¾“å…¥é€šé“æ•°
        embed_dim: int = 768,                     # åµŒå…¥ç»´åº¦
    ) -> None:
        """åˆå§‹åŒ–è¡¥ä¸åµŒå…¥æ¨¡å—ã€‚"""
        super().__init__()
        self.proj = nn.Conv2d(in_chans, embed_dim, kernel_size=kernel_size, stride=stride)

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """è®¡ç®—è¡¥ä¸åµŒå…¥ï¼Œé€šè¿‡å·ç§¯å¹¶è°ƒæ•´è¾“å‡ºç»´åº¦ã€‚"""
        return self.proj(x).permute(0, 2, 3, 1)  # B C H W -> B H W C

class Block(nn.Module):
    """å˜æ¢å—ï¼ŒåŒ…å«å¤šå¤´æ³¨æ„åŠ›å’ŒMLPã€‚"""

    def __init__(
        self,
        dim: int,
        num_heads: int,
        norm_layer: Type[nn.Module] = nn.LayerNorm,
        act_layer: Type[nn.Module] = nn.GELU,
    ) -> None:
        """åˆå§‹åŒ–å˜æ¢å—çš„å‚æ•°ã€‚"""
        super().__init__()
        self.norm1 = norm_layer(dim)  # å½’ä¸€åŒ–å±‚
        self.attn = Attention(dim, num_heads=num_heads)  # æ³¨æ„åŠ›æœºåˆ¶
        self.norm2 = norm_layer(dim)  # ç¬¬äºŒä¸ªå½’ä¸€åŒ–å±‚
        self.mlp = MLPBlock(embedding_dim=dim, mlp_dim=int(dim * 4), act=act_layer)  # MLPæ¨¡å—

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """æ‰§è¡Œå˜æ¢å—çš„å‰å‘ä¼ æ’­ã€‚"""
        shortcut = x
        x = self.norm1(x)  # å½’ä¸€åŒ–
        x = self.attn(x)   # æ³¨æ„åŠ›æœºåˆ¶
        x = shortcut + x   # æ®‹å·®è¿æ¥
        return x + self.mlp(self.norm2(x))  # å†æ¬¡å½’ä¸€åŒ–å¹¶é€šè¿‡MLP

class Attention(nn.Module):
    """å¤šå¤´æ³¨æ„åŠ›æ¨¡å—ã€‚"""

    def __init__(
        self,
        dim: int,
        num_heads: int = 8,
    ) -> None:
        """åˆå§‹åŒ–æ³¨æ„åŠ›æ¨¡å—çš„å‚æ•°ã€‚"""
        super().__init__()
        self.num_heads = num_heads
        head_dim = dim // num_heads
        self.scale = head_dim**-0.5  # ç¼©æ”¾å› å­

        self.qkv = nn.Linear(dim, dim * 3)  # çº¿æ€§å±‚ç”¨äºç”Ÿæˆq, k, v
        self.proj = nn.Linear(dim, dim)     # è¾“å‡ºçº¿æ€§å±‚

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """æ‰§è¡Œæ³¨æ„åŠ›æœºåˆ¶çš„å‰å‘ä¼ æ’­ã€‚"""
        B, H, W, _ = x.shape
        qkv = self.qkv(x).reshape(B, H * W, 3, self.num_heads, -1).permute(2, 0, 3, 1, 4)  # ç”Ÿæˆq, k, v
        q, k, v = qkv.reshape(3, B * self.num_heads, H * W, -1).unbind(0)  # åˆ†ç¦»q, k, v

        attn = (q * self.scale) @ k.transpose(-2, -1)  # è®¡ç®—æ³¨æ„åŠ›æƒé‡
        attn = attn.softmax(dim=-1)  # å½’ä¸€åŒ–
        x = (attn @ v).view(B, self.num_heads, H, W, -1).permute(0, 2, 3, 1, 4).reshape(B, H, W, -1)  # è®¡ç®—è¾“å‡º
        return self.proj(x)  # é€šè¿‡è¾“å‡ºçº¿æ€§å±‚
```

### ä»£ç è¯´æ˜
1. **ImageEncoderViT**: è¿™æ˜¯ä¸»è¦çš„å›¾åƒç¼–ç å™¨ç±»ï¼Œä½¿ç”¨è§†è§‰å˜æ¢å™¨æ¶æ„ã€‚å®ƒåŒ…å«äº†è¡¥ä¸åµŒå…¥ã€ä½ç½®åµŒå…¥ã€å¤šä¸ªå˜æ¢å—å’Œä¸€ä¸ªâ€œneckâ€æ¨¡å—æ¥ç”Ÿæˆæœ€ç»ˆçš„ç¼–ç è¡¨ç¤ºã€‚
2. **PatchEmbed**: è¯¥ç±»è´Ÿè´£å°†è¾“å…¥å›¾åƒåˆ†å‰²ä¸ºè¡¥ä¸å¹¶è¿›è¡ŒåµŒå…¥ï¼Œä½¿ç”¨å·ç§¯å±‚å®ç°ã€‚
3. **Block**: å˜æ¢å—ï¼ŒåŒ…å«æ³¨æ„åŠ›æœºåˆ¶å’Œå¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰ï¼Œå®ç°äº†æ®‹å·®è¿æ¥å’Œå½’ä¸€åŒ–ã€‚
4. **Attention**: å¤šå¤´æ³¨æ„åŠ›æ¨¡å—ï¼Œè®¡ç®—è¾“å…¥çš„æ³¨æ„åŠ›æƒé‡å¹¶ç”Ÿæˆè¾“å‡ºã€‚

é€šè¿‡è¿™äº›æ ¸å¿ƒéƒ¨åˆ†çš„å®ç°ï¼Œæ•´ä¸ªå›¾åƒç¼–ç å™¨èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†è¾“å…¥å›¾åƒå¹¶ç”Ÿæˆé«˜ç»´çš„ç‰¹å¾è¡¨ç¤ºã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®ç°äº†ä¸€ä¸ªåŸºäºè§†è§‰å˜æ¢å™¨ï¼ˆVision Transformer, ViTï¼‰æ¶æ„çš„å›¾åƒç¼–ç å™¨ï¼Œä»¥åŠä¸€ä¸ªç”¨äºç¼–ç ä¸åŒç±»å‹æç¤ºçš„æç¤ºç¼–ç å™¨ã€‚ä¸»è¦åŒ…å«ä¸‰ä¸ªç±»ï¼š`ImageEncoderViT`ã€`PromptEncoder`å’Œ`PositionEmbeddingRandom`ï¼Œä»¥åŠä¸€äº›è¾…åŠ©å‡½æ•°å’Œç±»ã€‚

`ImageEncoderViT`ç±»è´Ÿè´£å°†è¾“å…¥å›¾åƒç¼–ç ä¸ºç´§å‡‘çš„æ½œåœ¨ç©ºé—´è¡¨ç¤ºã€‚å®ƒé¦–å…ˆå°†å›¾åƒåˆ†å‰²æˆå¤šä¸ªå°å—ï¼ˆpatchesï¼‰ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—çš„å˜æ¢å—ï¼ˆtransformer blocksï¼‰å¤„ç†è¿™äº›å°å—ã€‚æ¯ä¸ªå˜æ¢å—éƒ½åŒ…å«å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œå‰é¦ˆç¥ç»ç½‘ç»œã€‚è¯¥ç±»çš„æ„é€ å‡½æ•°å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å¤šä¸ªå‚æ•°ï¼Œå¦‚è¾“å…¥å›¾åƒçš„å¤§å°ã€å—çš„å¤§å°ã€åµŒå…¥ç»´åº¦ã€å˜æ¢å—çš„æ·±åº¦ç­‰ã€‚ç¼–ç åçš„å°å—ç»è¿‡ä¸€ä¸ªâ€œé¢ˆéƒ¨â€æ¨¡å—ï¼ˆneckï¼‰è¿›ä¸€æ­¥å¤„ç†ï¼Œç”Ÿæˆæœ€ç»ˆçš„ç¼–ç è¡¨ç¤ºã€‚

`PromptEncoder`ç±»ç”¨äºç¼–ç ä¸åŒç±»å‹çš„æç¤ºï¼ŒåŒ…æ‹¬ç‚¹ã€æ¡†å’Œæ©ç ï¼Œä»¥ä¾¿è¾“å…¥åˆ°SAMçš„æ©ç è§£ç å™¨ã€‚å®ƒç”Ÿæˆç¨€ç–å’Œå¯†é›†çš„åµŒå…¥ï¼Œé€‚ç”¨äºè¾“å…¥çš„æç¤ºã€‚è¯¥ç±»çš„æ„é€ å‡½æ•°åŒæ ·å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åµŒå…¥ç»´åº¦ã€è¾“å…¥å›¾åƒå¤§å°ã€æ©ç è¾“å…¥é€šé“æ•°ç­‰ã€‚å®ƒåŒ…å«å¤šä¸ªæ–¹æ³•ï¼Œç”¨äºåµŒå…¥ç‚¹ã€æ¡†å’Œæ©ç ï¼Œå¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥å¹¶è¿”å›ç›¸åº”çš„åµŒå…¥è¡¨ç¤ºã€‚

`PositionEmbeddingRandom`ç±»ç”¨äºç”Ÿæˆéšæœºç©ºé—´é¢‘ç‡çš„ä½ç½®ä¿¡æ¯ç¼–ç ã€‚å®ƒé€šè¿‡æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å¯¹è¾“å…¥åæ ‡è¿›è¡Œç¼–ç ï¼Œå¸®åŠ©æ¨¡å‹æ•æ‰ç©ºé—´ä¿¡æ¯ã€‚

åœ¨è¿™äº›ç±»ä¸­ï¼Œè¿˜å®šä¹‰äº†ä¸€äº›è¾…åŠ©åŠŸèƒ½ï¼Œä¾‹å¦‚çª—å£åˆ†åŒºå’Œååˆ†åŒºã€ç›¸å¯¹ä½ç½®ç¼–ç çš„è®¡ç®—ç­‰ã€‚è¿™äº›åŠŸèƒ½ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿåœ¨å¤„ç†å¤§å°ºå¯¸å›¾åƒæ—¶æœ‰æ•ˆåœ°ç®¡ç†å†…å­˜å’Œè®¡ç®—èµ„æºã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºæ–‡ä»¶å®ç°äº†ä¸€ä¸ªå¼ºå¤§çš„å›¾åƒç¼–ç å™¨å’Œæç¤ºç¼–ç å™¨ï¼Œç»“åˆäº†ç°ä»£æ·±åº¦å­¦ä¹ ä¸­çš„ä¸€äº›é‡è¦æŠ€æœ¯ï¼Œå¦‚è‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œä½ç½®ç¼–ç ï¼Œé€‚ç”¨äºå„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡ã€‚

#### 11.3 ui.py

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ streamlit è¿è¡ŒæŒ‡å®šçš„è„šæœ¬
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤å¹¶ç­‰å¾…å…¶å®Œæˆ
    result = subprocess.run(command, shell=True)
    
    # æ£€æŸ¥å‘½ä»¤æ‰§è¡Œçš„è¿”å›ç ï¼Œå¦‚æœä¸ä¸º0åˆ™è¡¨ç¤ºå‡ºé”™
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")


# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # è¿™é‡Œå¯ä»¥ç›´æ¥æŒ‡å®šè„šæœ¬åï¼Œå‡è®¾å®ƒåœ¨å½“å‰ç›®å½•ä¸‹

    # è°ƒç”¨å‡½æ•°è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼š
   - `sys`ï¼šç”¨äºè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ã€‚
   - `subprocess`ï¼šç”¨äºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚

2. **`run_script` å‡½æ•°**ï¼š
   - è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•° `script_path`ï¼Œè¡¨ç¤ºè¦è¿è¡Œçš„ Python è„šæœ¬çš„è·¯å¾„ã€‚
   - ä½¿ç”¨ `sys.executable` è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ç¯å¢ƒè¿è¡Œè„šæœ¬ã€‚
   - æ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚
   - æ£€æŸ¥å‘½ä»¤çš„è¿”å›ç ï¼Œå¦‚æœè¿”å›ç ä¸ä¸º0ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œå¹¶æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

3. **ä¸»ç¨‹åºéƒ¨åˆ†**ï¼š
   - ä½¿ç”¨ `if __name__ == "__main__":` ç¡®ä¿è¯¥éƒ¨åˆ†ä»£ç ä»…åœ¨è„šæœ¬ç›´æ¥è¿è¡Œæ—¶æ‰§è¡Œã€‚
   - æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ‰§è¡Œè¯¥è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶åä¸º `ui.py`ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯ä½¿ç”¨å½“å‰çš„ Python ç¯å¢ƒæ¥è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„è„šæœ¬ï¼Œå…·ä½“æ˜¯é€šè¿‡ Streamlit æ¥å¯åŠ¨ä¸€ä¸ª Web åº”ç”¨ã€‚

ç¨‹åºé¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œè¿™äº›æ¨¡å—åˆ†åˆ«ç”¨äºè·å–ç³»ç»Ÿä¿¡æ¯ã€æ“ä½œæ–‡ä»¶ç³»ç»Ÿå’Œæ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚æ­¤å¤–ï¼Œè¿˜å¯¼å…¥äº† `abs_path` å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥è‡ª `QtFusion.path` æ¨¡å—ï¼Œç”¨äºè·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º `run_script` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•° `script_path`ï¼Œè¡¨ç¤ºè¦è¿è¡Œçš„è„šæœ¬çš„è·¯å¾„ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œé¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™é€šè¿‡ `sys.executable` å®ç°ã€‚ç„¶åï¼Œæ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œè¯¥å‘½ä»¤ç”¨äºé€šè¿‡ Streamlit è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚å‘½ä»¤çš„æ ¼å¼æ˜¯ `"{python_path}" -m streamlit run "{script_path}"`ï¼Œå…¶ä¸­ `{python_path}` å’Œ `{script_path}` åˆ†åˆ«è¢«æ›¿æ¢ä¸ºå½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„å’Œè¦è¿è¡Œçš„è„šæœ¬çš„è·¯å¾„ã€‚

æ¥ç€ï¼Œä½¿ç”¨ `subprocess.run` æ–¹æ³•æ‰§è¡Œæ„å»ºå¥½çš„å‘½ä»¤ã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œåè¿”å›çš„çŠ¶æ€ç ä¸ä¸º 0ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œç¨‹åºä¼šæ‰“å°å‡ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œä½¿ç”¨ `if __name__ == "__main__":` æ¥åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦ä½œä¸ºä¸»ç¨‹åºè¿è¡Œã€‚å¦‚æœæ˜¯ï¼Œåˆ™æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼Œè¿™é‡Œä½¿ç”¨ `abs_path("web.py")` æ¥è·å– `web.py` æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚æœ€åï¼Œè°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æ–¹ä¾¿åœ°é€šè¿‡å½“å‰ Python ç¯å¢ƒè¿è¡Œä¸€ä¸ª Streamlit è„šæœ¬ï¼Œé€‚åˆç”¨äºå¿«é€Ÿå¯åŠ¨ Web åº”ç”¨ã€‚

#### 11.4 train.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¸»è¦é›†ä¸­åœ¨YOLOæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹å’Œæ•°æ®å¤„ç†ä¸Šï¼š

```python
import random
import numpy as np
import torch.nn as nn
from ultralytics.data import build_dataloader, build_yolo_dataset
from ultralytics.engine.trainer import BaseTrainer
from ultralytics.models import yolo
from ultralytics.nn.tasks import DetectionModel
from ultralytics.utils import LOGGER, RANK
from ultralytics.utils.torch_utils import de_parallel, torch_distributed_zero_first

class DetectionTrainer(BaseTrainer):
    """
    æ‰©å±•è‡ªBaseTrainerç±»ï¼Œç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»ºYOLOæ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ï¼Œå¯ä»¥æ˜¯'train'æˆ–'val'ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œé€‚ç”¨äº'rect'æ¨¡å¼ã€‚é»˜è®¤ä¸ºNoneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)  # è·å–æ¨¡å‹çš„æœ€å¤§æ­¥å¹…
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]  # ç¡®ä¿æ¨¡å¼æœ‰æ•ˆ
        with torch_distributed_zero_first(rank):  # ä»…åœ¨DDPæƒ…å†µä¸‹åˆå§‹åŒ–æ•°æ®é›†*.cacheä¸€æ¬¡
            dataset = self.build_dataset(dataset_path, mode, batch_size)  # æ„å»ºæ•°æ®é›†
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        workers = self.args.workers if mode == "train" else self.args.workers * 2  # è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # å°†å›¾åƒè½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å½’ä¸€åŒ–
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©æ–°çš„å›¾åƒå¤§å°
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:  # å¦‚æœéœ€è¦ç¼©æ”¾
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è¿›è¡Œæ’å€¼ç¼©æ”¾
            batch["img"] = imgs  # æ›´æ–°æ‰¹æ¬¡å›¾åƒ
        return batch

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å›YOLOæ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )

    def plot_metrics(self):
        """ä»CSVæ–‡ä»¶ä¸­ç»˜åˆ¶æŒ‡æ ‡ã€‚"""
        plot_results(file=self.csv, on_plot=self.on_plot)  # ä¿å­˜ç»“æœå›¾
```

### ä»£ç è¯´æ˜ï¼š
1. **æ„å»ºæ•°æ®é›†**ï¼š`build_dataset`æ–¹æ³•è´Ÿè´£æ ¹æ®ç»™å®šçš„å›¾åƒè·¯å¾„å’Œæ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰æ„å»ºYOLOæ•°æ®é›†ï¼Œå¹¶è¿”å›ç›¸åº”çš„æ•°æ®é›†å¯¹è±¡ã€‚
2. **è·å–æ•°æ®åŠ è½½å™¨**ï¼š`get_dataloader`æ–¹æ³•æ„é€ æ•°æ®åŠ è½½å™¨ï¼Œæ”¯æŒå¤šè¿›ç¨‹åŠ è½½å’Œæ•°æ®æ‰“ä¹±ã€‚
3. **é¢„å¤„ç†æ‰¹æ¬¡**ï¼š`preprocess_batch`æ–¹æ³•å¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å½’ä¸€åŒ–å’Œå¤šå°ºåº¦è°ƒæ•´ã€‚
4. **è·å–æ¨¡å‹**ï¼š`get_model`æ–¹æ³•è¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©æ€§åœ°åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
5. **ç»˜åˆ¶è®­ç»ƒæ ·æœ¬å’ŒæŒ‡æ ‡**ï¼š`plot_training_samples`å’Œ`plot_metrics`æ–¹æ³•ç”¨äºå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ ·æœ¬å’Œæ€§èƒ½æŒ‡æ ‡ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒ YOLOï¼ˆYou Only Look Onceï¼‰ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è„šæœ¬ï¼Œç»§æ‰¿è‡ª `BaseTrainer` ç±»ã€‚å®ƒä¸»è¦è´Ÿè´£æ„å»ºæ•°æ®é›†ã€åŠ è½½æ•°æ®ã€é¢„å¤„ç†å›¾åƒã€è®¾ç½®æ¨¡å‹å±æ€§ã€è·å–æ¨¡å‹ã€éªŒè¯æ¨¡å‹ã€è®°å½•æŸå¤±ã€ç»˜åˆ¶è®­ç»ƒæ ·æœ¬å’Œç»˜åˆ¶è®­ç»ƒæŒ‡æ ‡ç­‰åŠŸèƒ½ã€‚

åœ¨æ–‡ä»¶å¼€å¤´ï¼Œå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ·±åº¦å­¦ä¹ ç›¸å…³çš„ PyTorch æ¨¡å—ä»¥åŠ Ultralytics YOLO çš„ç›¸å…³åŠŸèƒ½æ¨¡å—ã€‚

`DetectionTrainer` ç±»æ˜¯è¯¥æ–‡ä»¶çš„æ ¸å¿ƒï¼Œæä¾›äº†è®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹æ‰€éœ€çš„å„ç§æ–¹æ³•ã€‚é¦–å…ˆï¼Œ`build_dataset` æ–¹æ³•ç”¨äºæ„å»º YOLO æ•°æ®é›†ï¼Œæ¥å—å›¾åƒè·¯å¾„ã€æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰å’Œæ‰¹é‡å¤§å°ä½œä¸ºå‚æ•°ã€‚å®ƒä¼šæ ¹æ®æ¨¡å‹çš„æ­¥å¹…æ¥ç¡®å®šæ•°æ®é›†çš„å¤§å°ï¼Œå¹¶è°ƒç”¨ `build_yolo_dataset` å‡½æ•°ç”Ÿæˆæ•°æ®é›†ã€‚

æ¥ä¸‹æ¥ï¼Œ`get_dataloader` æ–¹æ³•æ„å»ºå¹¶è¿”å›æ•°æ®åŠ è½½å™¨ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒæ—¶åªåˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†ã€‚å®ƒæ ¹æ®æ¨¡å¼é€‰æ‹©æ˜¯å¦æ‰“ä¹±æ•°æ®ï¼Œå¹¶è®¾ç½®å·¥ä½œçº¿ç¨‹çš„æ•°é‡ã€‚

`preprocess_batch` æ–¹æ³•ç”¨äºå¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å°†å›¾åƒç¼©æ”¾åˆ°åˆé€‚çš„å¤§å°å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ã€‚å®ƒè¿˜æ”¯æŒå¤šå°ºåº¦è®­ç»ƒï¼Œéšæœºé€‰æ‹©å›¾åƒå¤§å°è¿›è¡Œè®­ç»ƒã€‚

`set_model_attributes` æ–¹æ³•ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ç­‰ï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ•°æ®ã€‚

`get_model` æ–¹æ³•è¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚

`get_validator` æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºéªŒè¯ YOLO æ¨¡å‹çš„éªŒè¯å™¨ï¼Œè®°å½•æŸå¤±åç§°ä»¥ä¾¿åç»­ä½¿ç”¨ã€‚

`label_loss_items` æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«æ ‡è®°è®­ç»ƒæŸå¤±é¡¹çš„å­—å…¸ï¼Œä¾¿äºè·Ÿè¸ªè®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±æƒ…å†µã€‚

`progress_string` æ–¹æ³•è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰çš„ epochã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ã€å®ä¾‹æ•°é‡å’Œå›¾åƒå¤§å°ç­‰ä¿¡æ¯ã€‚

`plot_training_samples` æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ ‡æ³¨ï¼Œæ–¹ä¾¿å¯è§†åŒ–è®­ç»ƒæ•°æ®çš„è´¨é‡ã€‚

æœ€åï¼Œ`plot_metrics` å’Œ `plot_training_labels` æ–¹æ³•åˆ†åˆ«ç”¨äºç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œæ ‡ç­¾ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£æ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºè®­ç»ƒ YOLO æ¨¡å‹ï¼Œæ”¯æŒå¤šç§åŠŸèƒ½å’Œçµæ´»çš„é…ç½®ï¼Œé€‚åˆç”¨äºç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚

#### 11.5 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\afpn.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶æ·»åŠ äº†è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F
from ..modules.conv import Conv

class BasicBlock(nn.Module):
    """åŸºæœ¬å—ï¼ŒåŒ…å«ä¸¤ä¸ªå·ç§¯å±‚å’Œæ®‹å·®è¿æ¥"""
    expansion = 1

    def __init__(self, filter_in, filter_out):
        super(BasicBlock, self).__init__()
        # ç¬¬ä¸€ä¸ªå·ç§¯å±‚ï¼Œä½¿ç”¨3x3å·ç§¯
        self.conv1 = Conv(filter_in, filter_out, 3)
        # ç¬¬äºŒä¸ªå·ç§¯å±‚ï¼Œä½¿ç”¨3x3å·ç§¯ï¼Œä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°
        self.conv2 = Conv(filter_out, filter_out, 3, act=False)

    def forward(self, x):
        residual = x  # ä¿å­˜è¾“å…¥ä»¥ç”¨äºæ®‹å·®è¿æ¥

        out = self.conv1(x)  # é€šè¿‡ç¬¬ä¸€ä¸ªå·ç§¯å±‚
        out = self.conv2(out)  # é€šè¿‡ç¬¬äºŒä¸ªå·ç§¯å±‚

        out += residual  # æ·»åŠ æ®‹å·®
        return self.conv1.act(out)  # è¿”å›ç»è¿‡æ¿€æ´»å‡½æ•°å¤„ç†çš„è¾“å‡º


class Upsample(nn.Module):
    """ä¸Šé‡‡æ ·æ¨¡å—"""
    def __init__(self, in_channels, out_channels, scale_factor=2):
        super(Upsample, self).__init__()
        # å®šä¹‰ä¸Šé‡‡æ ·çš„æ“ä½œ
        self.upsample = nn.Sequential(
            Conv(in_channels, out_channels, 1),  # 1x1å·ç§¯
            nn.Upsample(scale_factor=scale_factor, mode='bilinear')  # åŒçº¿æ€§æ’å€¼ä¸Šé‡‡æ ·
        )

    def forward(self, x):
        return self.upsample(x)  # è¿”å›ä¸Šé‡‡æ ·åçš„ç»“æœ


class Downsample_x2(nn.Module):
    """ä¸‹é‡‡æ ·æ¨¡å—ï¼Œç¼©å°ä¸€åŠ"""
    def __init__(self, in_channels, out_channels):
        super(Downsample_x2, self).__init__()
        # å®šä¹‰ä¸‹é‡‡æ ·æ“ä½œ
        self.downsample = Conv(in_channels, out_channels, 2, 2, 0)  # 2x2å·ç§¯ï¼Œæ­¥å¹…ä¸º2

    def forward(self, x):
        return self.downsample(x)  # è¿”å›ä¸‹é‡‡æ ·åçš„ç»“æœ


class ASFF_2(nn.Module):
    """è‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼Œå¤„ç†ä¸¤ä¸ªè¾“å…¥"""
    def __init__(self, inter_dim=512):
        super(ASFF_2, self).__init__()
        self.inter_dim = inter_dim
        compress_c = 8  # å‹ç¼©é€šé“æ•°

        # å®šä¹‰æƒé‡å·ç§¯å±‚
        self.weight_level_1 = Conv(self.inter_dim, compress_c, 1)
        self.weight_level_2 = Conv(self.inter_dim, compress_c, 1)
        self.weight_levels = nn.Conv2d(compress_c * 2, 2, kernel_size=1, stride=1, padding=0)
        self.conv = Conv(self.inter_dim, self.inter_dim, 3)  # èåˆåçš„å·ç§¯å±‚

    def forward(self, input1, input2):
        # è®¡ç®—æ¯ä¸ªè¾“å…¥çš„æƒé‡
        level_1_weight_v = self.weight_level_1(input1)
        level_2_weight_v = self.weight_level_2(input2)

        # åˆå¹¶æƒé‡å¹¶è®¡ç®—æœ€ç»ˆæƒé‡
        levels_weight_v = torch.cat((level_1_weight_v, level_2_weight_v), 1)
        levels_weight = self.weight_levels(levels_weight_v)
        levels_weight = F.softmax(levels_weight, dim=1)  # ä½¿ç”¨softmaxå½’ä¸€åŒ–æƒé‡

        # èåˆè¾“å…¥ç‰¹å¾
        fused_out_reduced = input1 * levels_weight[:, 0:1, :, :] + \
                            input2 * levels_weight[:, 1:2, :, :]

        out = self.conv(fused_out_reduced)  # é€šè¿‡å·ç§¯å±‚
        return out  # è¿”å›èåˆåçš„è¾“å‡º


class BlockBody_P345(nn.Module):
    """å¤„ç†3ä¸ªå°ºåº¦çš„ç‰¹å¾å—"""
    def __init__(self, channels=[64, 128, 256, 512]):
        super(BlockBody_P345, self).__init__()

        # å®šä¹‰ä¸åŒå°ºåº¦çš„å·ç§¯å±‚å’Œä¸‹é‡‡æ ·ã€ä¸Šé‡‡æ ·æ“ä½œ
        self.blocks_scalezero1 = nn.Sequential(Conv(channels[0], channels[0], 1))
        self.blocks_scaleone1 = nn.Sequential(Conv(channels[1], channels[1], 1))
        self.blocks_scaletwo1 = nn.Sequential(Conv(channels[2], channels[2], 1))

        self.downsample_scalezero1_2 = Downsample_x2(channels[0], channels[1])
        self.upsample_scaleone1_2 = Upsample(channels[1], channels[0], scale_factor=2)

        self.asff_scalezero1 = ASFF_2(inter_dim=channels[0])
        self.asff_scaleone1 = ASFF_2(inter_dim=channels[1])

        # å®šä¹‰åç»­çš„å·ç§¯å—å’Œä¸‹é‡‡æ ·ã€ä¸Šé‡‡æ ·æ“ä½œ
        self.blocks_scalezero2 = nn.Sequential(BasicBlock(channels[0], channels[0]), 
                                                BasicBlock(channels[0], channels[0]),
                                                BasicBlock(channels[0], channels[0]),
                                                BasicBlock(channels[0], channels[0]))
        self.blocks_scaleone2 = nn.Sequential(BasicBlock(channels[1], channels[1]), 
                                               BasicBlock(channels[1], channels[1]),
                                               BasicBlock(channels[1], channels[1]),
                                               BasicBlock(channels[1], channels[1]))

    def forward(self, x):
        x0, x1, x2 = x  # è·å–è¾“å…¥çš„ä¸‰ä¸ªå°ºåº¦

        # å¤„ç†æ¯ä¸ªå°ºåº¦çš„ç‰¹å¾
        x0 = self.blocks_scalezero1(x0)
        x1 = self.blocks_scaleone1(x1)
        x2 = self.blocks_scaletwo1(x2)

        # è¿›è¡Œè‡ªé€‚åº”ç‰¹å¾èåˆ
        scalezero = self.asff_scalezero1(x0, self.upsample_scaleone1_2(x1))
        scaleone = self.asff_scaleone1(self.downsample_scalezero1_2(x0), x1)

        # ç»§ç»­å¤„ç†èåˆåçš„ç‰¹å¾
        x0 = self.blocks_scalezero2(scalezero)
        x1 = self.blocks_scaleone2(scaleone)

        return x0, x1, x2  # è¿”å›å¤„ç†åçš„ç‰¹å¾

class AFPN_P345(nn.Module):
    """è‡ªé€‚åº”ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼Œå¤„ç†3ä¸ªå°ºåº¦çš„è¾“å…¥"""
    def __init__(self, in_channels=[256, 512, 1024], out_channels=256, factor=4):
        super(AFPN_P345, self).__init__()

        # å®šä¹‰è¾“å…¥é€šé“åˆ°è¾“å‡ºé€šé“çš„å·ç§¯å±‚
        self.conv0 = Conv(in_channels[0], in_channels[0] // factor, 1)
        self.conv1 = Conv(in_channels[1], in_channels[1] // factor, 1)
        self.conv2 = Conv(in_channels[2], in_channels[2] // factor, 1)

        # å®šä¹‰ç‰¹å¾å¤„ç†çš„ä¸»ä½“
        self.body = nn.Sequential(
            BlockBody_P345([in_channels[0] // factor, in_channels[1] // factor, in_channels[2] // factor])
        )

        # å®šä¹‰è¾“å‡ºå·ç§¯å±‚
        self.conv00 = Conv(in_channels[0] // factor, out_channels, 1)
        self.conv11 = Conv(in_channels[1] // factor, out_channels, 1)
        self.conv22 = Conv(in_channels[2] // factor, out_channels, 1)

    def forward(self, x):
        x0, x1, x2 = x  # è·å–è¾“å…¥çš„ä¸‰ä¸ªå°ºåº¦

        # é€šè¿‡å·ç§¯å±‚å¤„ç†è¾“å…¥
        x0 = self.conv0(x0)
        x1 = self.conv1(x1)
        x2 = self.conv2(x2)

        # é€šè¿‡ä¸»ä½“å¤„ç†ç‰¹å¾
        out0, out1, out2 = self.body([x0, x1, x2])

        # é€šè¿‡è¾“å‡ºå·ç§¯å±‚å¤„ç†ç‰¹å¾
        out0 = self.conv00(out0)
        out1 = self.conv11(out1)
        out2 = self.conv22(out2)
        return [out0, out1, out2]  # è¿”å›å¤„ç†åçš„è¾“å‡º
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è§£é‡Šï¼š
1. **BasicBlock**: å®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„å·ç§¯å—ï¼ŒåŒ…å«ä¸¤ä¸ªå·ç§¯å±‚å’Œæ®‹å·®è¿æ¥ï¼Œå¸¸ç”¨äºæ„å»ºæ·±åº¦ç½‘ç»œã€‚
2. **Upsample/Downsample**: å®ç°äº†ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·çš„æ¨¡å—ï¼Œåˆ†åˆ«ç”¨äºç‰¹å¾å›¾çš„å°ºå¯¸è°ƒæ•´ã€‚
3. **ASFF_2**: è‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼Œèƒ½å¤Ÿæ ¹æ®è¾“å…¥ç‰¹å¾çš„æƒé‡è¿›è¡ŒåŠ æƒèåˆï¼Œå¢å¼ºç‰¹å¾è¡¨è¾¾èƒ½åŠ›ã€‚
4. **BlockBody_P345**: å¤„ç†ä¸‰ä¸ªå°ºåº¦çš„ç‰¹å¾å—ï¼ŒåŒ…å«å¤šä¸ªå·ç§¯å±‚å’Œè‡ªé€‚åº”ç‰¹å¾èåˆæ“ä½œã€‚
5. **AFPN_P345**: è‡ªé€‚åº”ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼Œæ•´åˆä¸åŒå°ºåº¦çš„ç‰¹å¾ï¼Œé€šè¿‡å·ç§¯å±‚è¿›è¡Œç‰¹å¾æå–å’Œèåˆã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ä¸»è¦å®ç°äº†ä¸€ä¸ªæ”¹è¿›çš„ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼ˆAFPNï¼‰ï¼Œç”¨äºç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯YOLOv8ç®—æ³•ä¸­çš„ç‰¹å¾æå–éƒ¨åˆ†ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†å¤šä¸ªç±»å’Œæ¨¡å—ï¼Œä¸»è¦åŒ…æ‹¬åŸºæœ¬çš„å·ç§¯å—ã€ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·æ¨¡å—ï¼Œä»¥åŠè‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼ˆASFFï¼‰ï¼Œè¿™äº›æ¨¡å—åœ¨ç‰¹å¾é‡‘å­—å¡”çš„æ„å»ºä¸­èµ·åˆ°äº†é‡è¦ä½œç”¨ã€‚

é¦–å…ˆï¼Œ`BasicBlock`ç±»å®šä¹‰äº†ä¸€ä¸ªåŸºæœ¬çš„å·ç§¯å—ï¼ŒåŒ…å«ä¸¤ä¸ªå·ç§¯å±‚ï¼Œä½¿ç”¨æ®‹å·®è¿æ¥ä»¥ä¾¿äºè®­ç»ƒæ›´æ·±çš„ç½‘ç»œã€‚`Upsample`å’Œ`Downsample`ç±»åˆ™åˆ†åˆ«å®ç°äº†ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·çš„åŠŸèƒ½ï¼Œé€šè¿‡å·ç§¯å’Œæ’å€¼æ“ä½œè°ƒæ•´ç‰¹å¾å›¾çš„å°ºå¯¸ã€‚

æ¥ä¸‹æ¥ï¼Œ`ASFF_2`ã€`ASFF_3`å’Œ`ASFF_4`ç±»å®ç°äº†è‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼Œèƒ½å¤Ÿæ ¹æ®è¾“å…¥ç‰¹å¾å›¾çš„æƒé‡åŠ¨æ€åœ°èåˆä¸åŒå°ºåº¦çš„ç‰¹å¾ã€‚è¿™äº›æ¨¡å—é€šè¿‡è®¡ç®—è¾“å…¥ç‰¹å¾å›¾çš„æƒé‡å¹¶è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œæ¥å¢å¼ºç‰¹å¾çš„è¡¨è¾¾èƒ½åŠ›ã€‚

`BlockBody_P345`å’Œ`BlockBody_P2345`ç±»æ˜¯ç‰¹å¾é‡‘å­—å¡”çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£æ„å»ºå¤šå°ºåº¦çš„ç‰¹å¾æå–ç»“æ„ã€‚å®ƒä»¬ä½¿ç”¨äº†å¤šä¸ªåŸºæœ¬å—å’Œè‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼Œé€šè¿‡ä¸åŒçš„ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·æ“ä½œï¼Œè¿æ¥ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ï¼Œä»¥å®ç°æ›´å¥½çš„ç‰¹å¾è¡¨è¾¾ã€‚

`AFPN_P345`å’Œ`AFPN_P2345`ç±»åˆ™æ˜¯ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œçš„æ•´ä½“ç»“æ„ï¼Œè´Ÿè´£è¾“å…¥ç‰¹å¾å›¾çš„å¤„ç†å’Œè¾“å‡ºç‰¹å¾å›¾çš„ç”Ÿæˆã€‚å®ƒä»¬é€šè¿‡å·ç§¯å±‚å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†åçš„ç‰¹å¾ä¼ é€’ç»™ç›¸åº”çš„å—ä½“ï¼Œæœ€ç»ˆè¾“å‡ºç»è¿‡å¤„ç†çš„ç‰¹å¾å›¾ã€‚

æ­¤å¤–ï¼Œ`BlockBody_P345_Custom`å’Œ`BlockBody_P2345_Custom`ç±»å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å—çš„ç±»å‹ï¼Œä»¥ä¾¿åœ¨ç‰¹å®šä»»åŠ¡ä¸­è¿›è¡Œæ›´çµæ´»çš„ç‰¹å¾æå–ã€‚è¿™äº›è‡ªå®šä¹‰ç±»é€šè¿‡ä¼ å…¥ä¸åŒçš„å—ç±»å‹ï¼Œå¯ä»¥åœ¨ç½‘ç»œä¸­ä½¿ç”¨ä¸åŒçš„ç»“æ„ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªç¨‹åºæ–‡ä»¶å®ç°äº†ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œç»“æ„ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒçš„è¾“å…¥ç‰¹å¾å’Œä»»åŠ¡éœ€æ±‚ï¼Œæå‡ç›®æ ‡æ£€æµ‹çš„æ€§èƒ½ã€‚

#### 11.6 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\engine\trainer.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
class BaseTrainer:
    """
    BaseTrainerç±»æ˜¯ç”¨äºåˆ›å»ºè®­ç»ƒå™¨çš„åŸºç±»ã€‚

    å±æ€§:
        args (SimpleNamespace): è®­ç»ƒå™¨çš„é…ç½®ã€‚
        model (nn.Module): æ¨¡å‹å®ä¾‹ã€‚
        device (torch.device): ç”¨äºè®­ç»ƒçš„è®¾å¤‡ã€‚
        trainset (torch.utils.data.Dataset): è®­ç»ƒæ•°æ®é›†ã€‚
        testset (torch.utils.data.Dataset): æµ‹è¯•æ•°æ®é›†ã€‚
        optimizer (torch.optim.Optimizer): ä¼˜åŒ–å™¨å®ä¾‹ã€‚
        scheduler (torch.optim.lr_scheduler._LRScheduler): å­¦ä¹ ç‡è°ƒåº¦å™¨ã€‚
    """

    def __init__(self, cfg=DEFAULT_CFG, overrides=None):
        """
        åˆå§‹åŒ–BaseTrainerç±»ã€‚

        å‚æ•°:
            cfg (str, optional): é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸ºDEFAULT_CFGã€‚
            overrides (dict, optional): é…ç½®è¦†ç›–ï¼Œé»˜è®¤ä¸ºNoneã€‚
        """
        self.args = get_cfg(cfg, overrides)  # è·å–é…ç½®
        self.device = select_device(self.args.device, self.args.batch)  # é€‰æ‹©è®¾å¤‡
        self.model = None  # åˆå§‹åŒ–æ¨¡å‹
        self.trainset, self.testset = None, None  # åˆå§‹åŒ–è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†
        self.optimizer = None  # åˆå§‹åŒ–ä¼˜åŒ–å™¨
        self.scheduler = None  # åˆå§‹åŒ–å­¦ä¹ ç‡è°ƒåº¦å™¨

    def train(self):
        """å¼€å§‹è®­ç»ƒè¿‡ç¨‹ã€‚"""
        world_size = self._get_world_size()  # è·å–ä¸–ç•Œå¤§å°ï¼ˆGPUæ•°é‡ï¼‰

        if world_size > 1 and 'LOCAL_RANK' not in os.environ:
            # å¦‚æœæ˜¯å¤šGPUè®­ç»ƒï¼Œè®¾ç½®åˆ†å¸ƒå¼è®­ç»ƒ
            self._setup_ddp(world_size)
        else:
            self._do_train(world_size)  # å•GPUè®­ç»ƒ

    def _setup_ddp(self, world_size):
        """åˆå§‹åŒ–åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œï¼ˆDDPï¼‰å‚æ•°ã€‚"""
        torch.cuda.set_device(RANK)  # è®¾ç½®å½“å‰GPU
        dist.init_process_group('nccl', rank=RANK, world_size=world_size)  # åˆå§‹åŒ–è¿›ç¨‹ç»„

    def _do_train(self, world_size=1):
        """æ‰§è¡Œè®­ç»ƒè¿‡ç¨‹ã€‚"""
        self._setup_train(world_size)  # è®¾ç½®è®­ç»ƒç¯å¢ƒ

        for epoch in range(self.args.epochs):
            self.model.train()  # è®¾ç½®æ¨¡å‹ä¸ºè®­ç»ƒæ¨¡å¼
            for batch in self.train_loader:  # éå†è®­ç»ƒæ•°æ®
                self.optimizer.zero_grad()  # æ¸…ç©ºæ¢¯åº¦
                loss = self.model(batch)  # å‰å‘ä¼ æ’­è®¡ç®—æŸå¤±
                loss.backward()  # åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦
                self.optimizer.step()  # æ›´æ–°å‚æ•°

    def _setup_train(self, world_size):
        """è®¾ç½®è®­ç»ƒçš„ç›¸å…³å‚æ•°å’Œæ•°æ®åŠ è½½å™¨ã€‚"""
        self.model = self.setup_model()  # è®¾ç½®æ¨¡å‹
        self.train_loader = self.get_dataloader(self.trainset)  # è·å–è®­ç»ƒæ•°æ®åŠ è½½å™¨
        self.optimizer = self.build_optimizer(self.model)  # æ„å»ºä¼˜åŒ–å™¨
        self.scheduler = self.build_scheduler(self.optimizer)  # æ„å»ºå­¦ä¹ ç‡è°ƒåº¦å™¨

    def setup_model(self):
        """åŠ è½½æˆ–åˆ›å»ºæ¨¡å‹ã€‚"""
        # æ­¤å¤„çœç•¥æ¨¡å‹åŠ è½½çš„å…·ä½“å®ç°
        return model

    def build_optimizer(self, model):
        """æ„å»ºä¼˜åŒ–å™¨ã€‚"""
        return optim.Adam(model.parameters(), lr=self.args.lr)  # ä½¿ç”¨Adamä¼˜åŒ–å™¨

    def build_scheduler(self, optimizer):
        """æ„å»ºå­¦ä¹ ç‡è°ƒåº¦å™¨ã€‚"""
        return optim.lr_scheduler.StepLR(optimizer, step_size=10, gamma=0.1)  # æ¯10ä¸ªepochå­¦ä¹ ç‡è¡°å‡

    def get_dataloader(self, dataset):
        """è·å–æ•°æ®åŠ è½½å™¨ã€‚"""
        return DataLoader(dataset, batch_size=self.args.batch, shuffle=True)  # è¿”å›æ•°æ®åŠ è½½å™¨
```

### ä»£ç è¯´æ˜
1. **BaseTrainerç±»**: è¿™æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒæ¨¡å‹çš„åŸºç±»ï¼ŒåŒ…å«äº†æ¨¡å‹è®­ç»ƒæ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½å’Œå±æ€§ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**: åœ¨åˆå§‹åŒ–æ—¶ï¼Œè·å–é…ç½®ã€é€‰æ‹©è®¾å¤‡ã€åˆå§‹åŒ–æ¨¡å‹å’Œæ•°æ®é›†ç­‰ã€‚
3. **trainæ–¹æ³•**: è¿™æ˜¯è®­ç»ƒçš„å…¥å£ï¼Œè´Ÿè´£å¯åŠ¨è®­ç»ƒè¿‡ç¨‹ã€‚
4. **_setup_ddpæ–¹æ³•**: å¦‚æœä½¿ç”¨å¤šGPUè®­ç»ƒï¼Œåˆå§‹åŒ–åˆ†å¸ƒå¼è®­ç»ƒçš„å‚æ•°ã€‚
5. **_do_trainæ–¹æ³•**: è¿›è¡Œå®é™…çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬å‰å‘ä¼ æ’­ã€æŸå¤±è®¡ç®—å’Œå‚æ•°æ›´æ–°ã€‚
6. **setup_modelæ–¹æ³•**: åŠ è½½æˆ–åˆ›å»ºæ¨¡å‹çš„é€»è¾‘ã€‚
7. **build_optimizerå’Œbuild_scheduleræ–¹æ³•**: åˆ†åˆ«ç”¨äºæ„å»ºä¼˜åŒ–å™¨å’Œå­¦ä¹ ç‡è°ƒåº¦å™¨ï¼Œæ§åˆ¶æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚

ä»¥ä¸Šæ˜¯ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†å’Œè¯¦ç»†æ³¨é‡Šï¼Œæ¶µç›–äº†æ¨¡å‹è®­ç»ƒçš„ä¸»è¦æµç¨‹å’Œé€»è¾‘ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ç”¨äºè®­ç»ƒYOLOv8æ¨¡å‹çš„æ ¸å¿ƒä»£ç ï¼Œä¸»è¦å®ç°äº†æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼ŒåŠŸèƒ½æ¨¡å—åŒ–ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†ä¸€ç³»åˆ—å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€æ–‡ä»¶æ“ä½œã€æ—¶é—´å¤„ç†ã€æ·±åº¦å­¦ä¹ æ¡†æ¶PyTorchç­‰ã€‚æ¥ç€ï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º`BaseTrainer`çš„ç±»ï¼Œè¿™æ˜¯æ‰€æœ‰è®­ç»ƒå™¨çš„åŸºç±»ï¼ŒåŒ…å«äº†è®­ç»ƒæ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½å’Œå±æ€§ã€‚

åœ¨`__init__`æ–¹æ³•ä¸­ï¼Œåˆå§‹åŒ–äº†ä¸€äº›é‡è¦çš„å±æ€§ï¼ŒåŒ…æ‹¬é…ç½®å‚æ•°ã€è®¾å¤‡é€‰æ‹©ã€æ¨¡å‹å’Œæ•°æ®é›†çš„å‡†å¤‡ç­‰ã€‚é€šè¿‡`get_cfg`å‡½æ•°è·å–é…ç½®ï¼Œå¹¶æ ¹æ®é…ç½®åˆ›å»ºç›¸åº”çš„ç›®å½•ä»¥ä¿å­˜è®­ç»ƒç»“æœå’Œæ¨¡å‹æƒé‡ã€‚è¿˜æ£€æŸ¥äº†æ•°æ®é›†çš„æœ‰æ•ˆæ€§ï¼Œå¹¶æ ¹æ®ä»»åŠ¡ç±»å‹ï¼ˆåˆ†ç±»ã€æ£€æµ‹ç­‰ï¼‰åŠ è½½ç›¸åº”çš„æ•°æ®é›†ã€‚

`train`æ–¹æ³•æ˜¯è®­ç»ƒçš„å…¥å£ï¼Œé¦–å…ˆåˆ¤æ–­è®¾å¤‡çš„æ•°é‡å¹¶è®¾ç½®åˆ†å¸ƒå¼è®­ç»ƒçš„ç›¸å…³å‚æ•°ã€‚å¦‚æœæ˜¯å¤šGPUè®­ç»ƒï¼Œåˆ™ç”Ÿæˆç›¸åº”çš„å‘½ä»¤å¹¶å¯åŠ¨å­è¿›ç¨‹ï¼›å¦‚æœæ˜¯å•GPUè®­ç»ƒï¼Œåˆ™ç›´æ¥è°ƒç”¨`_do_train`æ–¹æ³•è¿›è¡Œè®­ç»ƒã€‚

`_setup_ddp`å’Œ`_setup_train`æ–¹æ³•åˆ†åˆ«ç”¨äºåˆå§‹åŒ–åˆ†å¸ƒå¼è®­ç»ƒå’Œè®¾ç½®è®­ç»ƒæ‰€éœ€çš„æ¨¡å‹ã€æ•°æ®åŠ è½½å™¨å’Œä¼˜åŒ–å™¨ã€‚åœ¨`_setup_train`ä¸­ï¼Œæ¨¡å‹çš„å„ä¸ªå±‚å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å†»ç»“ï¼Œé˜²æ­¢å…¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ›´æ–°ã€‚

`_do_train`æ–¹æ³•å®ç°äº†è®­ç»ƒçš„æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬æ¯ä¸ªepochçš„è®­ç»ƒè¿‡ç¨‹ã€æŸå¤±è®¡ç®—ã€ä¼˜åŒ–å™¨æ­¥éª¤ã€æ¨¡å‹éªŒè¯ç­‰ã€‚åœ¨æ¯ä¸ªbatchçš„è®­ç»ƒä¸­ï¼Œé¦–å…ˆè¿›è¡Œå‰å‘ä¼ æ’­è®¡ç®—æŸå¤±ï¼Œç„¶åè¿›è¡Œåå‘ä¼ æ’­å’Œä¼˜åŒ–æ­¥éª¤ã€‚è¿˜åŒ…æ‹¬å¯¹è®­ç»ƒè¿‡ç¨‹çš„ç›‘æ§å’Œæ—¥å¿—è®°å½•ã€‚

æ¨¡å‹çš„ä¿å­˜å’Œæ¢å¤åŠŸèƒ½ä¹Ÿåœ¨`BaseTrainer`ç±»ä¸­å®ç°ï¼Œ`save_model`æ–¹æ³•è´Ÿè´£ä¿å­˜å½“å‰æ¨¡å‹çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è®­ç»ƒçš„epochã€æœ€ä½³çš„fitnesså€¼ã€æ¨¡å‹æƒé‡ç­‰ä¿¡æ¯ã€‚`resume_training`æ–¹æ³•åˆ™ç”¨äºä»æŒ‡å®šçš„æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒã€‚

æ­¤å¤–ï¼Œç±»ä¸­è¿˜å®šä¹‰äº†ä¸€äº›è¾…åŠ©æ–¹æ³•ï¼Œä¾‹å¦‚`validate`ç”¨äºåœ¨éªŒè¯é›†ä¸Šè¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œ`build_optimizer`ç”¨äºæ„å»ºä¼˜åŒ–å™¨ï¼Œ`get_dataset`ç”¨äºè·å–è®­ç»ƒå’ŒéªŒè¯æ•°æ®é›†çš„è·¯å¾„ç­‰ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†YOLOv8æ¨¡å‹è®­ç»ƒçš„å®Œæ•´æµç¨‹ï¼Œæ¶µç›–äº†ä»æ•°æ®å‡†å¤‡ã€æ¨¡å‹æ„å»ºã€è®­ç»ƒè¿‡ç¨‹åˆ°æ¨¡å‹ä¿å­˜çš„å„ä¸ªæ–¹é¢ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥ç¨‹åºæ•´ä½“æ„æ¶æ˜¯ä¸€ä¸ªåŸºäºYOLOv8çš„ç›®æ ‡æ£€æµ‹æ¡†æ¶ï¼Œæ¶µç›–äº†ä»æ¨¡å‹è®­ç»ƒã€ç‰¹å¾æå–ã€æ•°æ®å¤„ç†åˆ°å¯è§†åŒ–å’Œç›‘æ§çš„å¤šä¸ªæ–¹é¢ã€‚ä¸»è¦åŠŸèƒ½æ¨¡å—åŒ…æ‹¬ï¼š

1. **æ¨¡å‹è®­ç»ƒ**ï¼šæä¾›äº†è®­ç»ƒYOLOv8æ¨¡å‹çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€æ¨¡å‹æ„å»ºã€è®­ç»ƒè¿‡ç¨‹ã€æŸå¤±è®¡ç®—å’Œæ¨¡å‹ä¿å­˜ç­‰ã€‚
2. **ç‰¹å¾æå–**ï¼šå®ç°äº†æ”¹è¿›çš„ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼ˆAFPNï¼‰å’Œè‡ªé€‚åº”ç‰¹å¾èåˆï¼ˆASFFï¼‰æ¨¡å—ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚
3. **æ•°æ®å¤„ç†**ï¼šæ”¯æŒå¤šç§æ•°æ®é›†æ ¼å¼ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ„å»ºå’ŒåŠ è½½è®­ç»ƒå’ŒéªŒè¯æ•°æ®é›†ã€‚
4. **å¯è§†åŒ–å’Œç›‘æ§**ï¼šé€šè¿‡Webç•Œé¢ï¼ˆä½¿ç”¨Streamlitï¼‰å’Œè®­ç»ƒæ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›‘æ§è®­ç»ƒè¿‡ç¨‹å’Œæ¨¡å‹æ€§èƒ½ã€‚
5. **æ¨¡å‹æ¨ç†**ï¼šæä¾›äº†æ¨¡å‹æ¨ç†çš„åŠŸèƒ½ï¼Œæ”¯æŒå¯¹æ–°æ•°æ®è¿›è¡Œç›®æ ‡æ£€æµ‹å’Œåˆ†ç±»ã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                                                                               | åŠŸèƒ½æè¿°                                                                                       |
|------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| `code\ultralytics\hub\session.py`                                                                    | ç®¡ç†ä¸Ultralytics HUBçš„è®­ç»ƒä¼šè¯ï¼ŒåŒ…æ‹¬æ¨¡å‹åŠ è½½ã€å¿ƒè·³ç›‘æµ‹å’Œæ£€æŸ¥ç‚¹ä¸Šä¼ ç­‰åŠŸèƒ½ã€‚                           |
| `code\ultralytics\models\sam\modules\encoders.py`                                                   | å®ç°å›¾åƒç¼–ç å™¨å’Œæç¤ºç¼–ç å™¨ï¼Œä½¿ç”¨è§†è§‰å˜æ¢å™¨æ¶æ„ï¼Œæ”¯æŒå¤šç§è¾“å…¥æç¤ºç±»å‹ã€‚                                   |
| `ui.py`                                                                                              | å¯åŠ¨Streamlit Webåº”ç”¨ï¼Œæ–¹ä¾¿ç”¨æˆ·é€šè¿‡Webç•Œé¢ä¸æ¨¡å‹è¿›è¡Œäº¤äº’ã€‚                                         |
| `train.py`                                                                                           | è´Ÿè´£YOLOv8æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®é›†æ„å»ºã€æ¨¡å‹è®­ç»ƒã€æŸå¤±è®¡ç®—å’Œæ¨¡å‹ä¿å­˜ç­‰åŠŸèƒ½ã€‚                       |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\afpn.py`      | å®ç°æ”¹è¿›çš„ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼ˆAFPNï¼‰ï¼ŒåŒ…å«è‡ªé€‚åº”ç‰¹å¾èåˆæ¨¡å—ï¼ˆASFFï¼‰ï¼Œå¢å¼ºç‰¹å¾æå–èƒ½åŠ›ã€‚                  |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\engine\trainer.py`            | å®šä¹‰è®­ç»ƒå™¨ç±»ï¼Œå¤„ç†æ¨¡å‹è®­ç»ƒçš„æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬è®­ç»ƒã€éªŒè¯ã€æ¨¡å‹ä¿å­˜å’Œæ¢å¤ç­‰åŠŸèƒ½ã€‚                         |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\yolo\pose\train.py`  | å¤„ç†YOLOv8å§¿æ€ä¼°è®¡æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼Œå…·ä½“å®ç°å¯èƒ½ä¸ç›®æ ‡æ£€æµ‹ç›¸ä¼¼ã€‚                                      |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\trackers\__init__.py`       | åˆå§‹åŒ–è·Ÿè¸ªå™¨æ¨¡å—ï¼Œå¯èƒ½ç”¨äºç›®æ ‡è·Ÿè¸ªä»»åŠ¡ã€‚                                                        |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\autobatch.py`         | å®ç°è‡ªåŠ¨æ‰¹å¤„ç†åŠŸèƒ½ï¼Œä¼˜åŒ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ•°æ®åŠ è½½å’Œå¤„ç†ã€‚                                             |
| `code\ultralytics\utils\callbacks\comet.py`                                                         | å®ç°ä¸Comet.mlçš„é›†æˆï¼Œç”¨äºç›‘æ§å’Œè®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œè¶…å‚æ•°ã€‚                                   |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\callbacks\clearml.py`  | å®ç°ä¸ClearMLçš„é›†æˆï¼Œæä¾›è®­ç»ƒç›‘æ§å’Œç®¡ç†åŠŸèƒ½ã€‚                                                  |
| `code\ultralytics\models\yolo\classify\predict.py`                                                 | å®ç°YOLOv8æ¨¡å‹çš„æ¨ç†åŠŸèƒ½ï¼Œæ”¯æŒå¯¹æ–°æ•°æ®è¿›è¡Œåˆ†ç±»å’Œç›®æ ‡æ£€æµ‹ã€‚                                        |

è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†å„ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå¸®åŠ©ç†è§£æ•´ä¸ªé¡¹ç›®çš„ç»“æ„å’Œå„ä¸ªæ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/ZpuWl5dp](https://mbd.pub/o/bread/ZpuWl5dp)